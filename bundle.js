(()=>{var $e=Object.defineProperty;var ae=(e,r)=>()=>(e&&(r=e(e=0)),r);var oe=(e,r)=>{for(var u in r)$e(e,u,{get:r[u],enumerable:!0})};var Ee={};oe(Ee,{initReviewForm:()=>Pe});function Pe(){let e=document.querySelector('[data-form-id="challenge-review"]');if(!e)return;let r=Array.from(e.querySelectorAll("[data-form-step]"));if(!r.length)return;let u=Array.from(e.querySelectorAll("[data-progress-step]")),l=e.querySelector("[data-progress-status]"),b=e.querySelector("[data-form-next]"),S=e.querySelector("[data-form-prev]"),d=e.querySelector("[data-form-submit]"),v=e.querySelector("#registration-explanation textarea"),x=e.querySelectorAll('input[name="wv-registered"]'),k=e.querySelectorAll('input[name="prior-remedy"]'),$=e.querySelectorAll("[data-prior-remedy]"),m=e.querySelector("#decision-date"),h=e.querySelector("[data-date-warning]"),T=e.querySelector("[data-deadline-notes]"),g=T?.querySelector("textarea"),A=Array.from(e.querySelectorAll("input, select, textarea"));A.forEach(a=>{if(a.hasAttribute("required")&&(a.dataset.originalRequired="true"),!("originalTabIndex"in a.dataset)){let c=a.getAttribute("tabindex");c!==null?a.dataset.originalTabIndex=c:a.dataset.originalTabIndex=""}});let L=0,N="reviewFormState",I=(()=>{if(typeof window>"u")return{type:"none",getItem:()=>null,setItem:()=>{},removeItem:()=>{}};try{let{sessionStorage:s}=window;if(s){let p=`${N}__test`;return s.setItem(p,"1"),s.removeItem(p),{type:"session",getItem:f=>s.getItem(f),setItem:(f,E)=>s.setItem(f,E),removeItem:f=>s.removeItem(f)}}}catch(s){console.warn("Session storage is unavailable; attempting alternative persistence.",s)}if(typeof window.history<"u"&&typeof window.history.replaceState=="function")return{type:"history",getItem:s=>{let p=window.history.state;if(!p||typeof p!="object")return null;let f=p[s];return typeof f=="string"?f:null},setItem:(s,p)=>{try{let f=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};f[s]=p,window.history.replaceState(f,document.title)}catch(f){console.warn("Failed to persist form state with the History API.",f)}},removeItem:s=>{try{let p=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};s in p&&(delete p[s],window.history.replaceState(p,document.title))}catch(p){console.warn("Failed to clear form state from the History API.",p)}}};let c={};return console.warn("Falling back to in-memory form persistence; progress will be lost if the page reloads."),{type:"memory",getItem:s=>Object.prototype.hasOwnProperty.call(c,s)?c[s]:null,setItem:(s,p)=>{c[s]=p},removeItem:s=>{delete c[s]}}})(),F=I.type!=="none",O=I.type==="memory",W="You have unsaved changes. Leave anyway?",R=!1,G=!1,te=a=>{if(R)return a.preventDefault(),a.returnValue=W,W},J=()=>{!O||typeof window>"u"||(R&&!G?(window.addEventListener("beforeunload",te),G=!0):!R&&G&&(window.removeEventListener("beforeunload",te),G=!1))},B=null,le=a=>typeof RadioNodeList<"u"&&a instanceof RadioNodeList,re=a=>{let c=Object.values(a||{});return L>0||c.some(s=>Array.isArray(s)?s.some(p=>String(p??"").trim()!==""):String(s??"").trim()!=="")},Y=()=>{if(F)try{let a=new FormData(e),c={};a.forEach((f,E)=>{if(E)if(Object.prototype.hasOwnProperty.call(c,E)){let M=c[E];c[E]=Array.isArray(M)?[...M,f]:[M,f]}else c[E]=f});let p=JSON.stringify({currentStep:L,data:c});I.setItem(N,p),R=re(c),J()}catch(a){console.warn("Failed to save form state:",a),R=!1,J()}},P=()=>{F&&(typeof window<"u"?(window.clearTimeout(B),B=window.setTimeout(()=>{Y(),B=null},200)):Y())},K=()=>{if(F){try{I.removeItem(N)}catch(a){console.warn("Failed to clear saved form state:",a)}typeof window<"u"&&B!==null&&(window.clearTimeout(B),B=null),R=!1,J()}},de=()=>{if(!F)return!1;let a="";try{a=I.getItem(N)||""}catch(E){return console.warn("Failed to read saved form state:",E),!1}if(!a)return!1;let c;try{c=JSON.parse(a)}catch(E){return console.warn("Corrupt saved form state detected; clearing.",E),K(),!1}if(!c||typeof c!="object")return!1;let{currentStep:s=0,data:p={}}=c;Object.entries(p).forEach(([E,M])=>{if(!E)return;let t=e.elements[E];if(!t)return;let n=Array.isArray(M)?M:[M];if(le(t)){Array.from(t).forEach(o=>{o.checked=n.includes(o.value)});return}let i=o=>{if(o){if(o.type==="checkbox"){o.checked=n.includes(o.value)||!o.value&&n.includes("on");return}if(o.type==="radio"){o.checked=n.includes(o.value);return}if(o.type==="select-multiple"){Array.from(o.options).forEach(y=>{y.selected=n.includes(y.value)});return}typeof o.value=="string"&&(o.value=n[n.length-1]??"")}};typeof t.length=="number"&&!t.tagName?Array.from(t).forEach(i):i(t)});let f=Number.isInteger(s)?Math.min(Math.max(s,0),r.length-1):0;return U(f,{focusField:!1}),R=re(p),J(),!0},Z=()=>{r.forEach((a,c)=>{let s=c===L;a.hidden=!s,a.classList.toggle("is-active",s),a.setAttribute("aria-hidden",s?"false":"true"),a.querySelectorAll("input, select, textarea").forEach(f=>{if(f.type!=="hidden")if(f.dataset.originalRequired==="true"&&(f.required=s),s){let E=f.dataset.originalTabIndex??"";E?f.setAttribute("tabindex",E):f.removeAttribute("tabindex")}else f.setAttribute("tabindex","-1")})}),u.forEach((a,c)=>{let s=c===L;a.classList.toggle("is-active",s),a.classList.toggle("is-complete",c<L),a.setAttribute("aria-current",s?"step":"false")}),l&&(l.textContent=`Step ${L+1} of ${r.length}`),S&&(S.disabled=L===0),b&&(b.hidden=L===r.length-1),d&&(d.hidden=L!==r.length-1)},ne=()=>{let a=r[L];if(!a)return;let c=a.querySelector('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])');c&&c.focus({preventScroll:!1})},U=(a,{focusField:c=!0}={})=>{let s=Math.min(Math.max(a,0),r.length-1);if(s===L){Z(),c&&window.requestAnimationFrame(ne);return}L=s,Z(),c&&window.requestAnimationFrame(ne)},H=()=>{if(!v)return;let c=e.querySelector('input[name="wv-registered"]:checked')?.value==="no";v.required=!!c},V=()=>{let a=e.querySelector('input[name="prior-remedy"]:checked')?.value;$.forEach(c=>{let s=a&&c.dataset.priorRemedy===a;c.hidden=!s;let p=c.querySelector("textarea");p&&(p.required=s&&a==="yes")})},j=()=>{if(!m)return;let a=m.value;if(!a){h&&(h.hidden=!0,h.textContent=""),T&&(T.hidden=!0),g&&(g.required=!1);return}let c=new Date(`${a}T00:00:00`);if(Number.isNaN(c.getTime()))return;let s=new Date,f=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()-c.getTime(),E=Math.floor(f/864e5),M="",t=!1,n=!1;if(E>30)M=`This date is ${E} days old. WVSDEC filings must arrive within 30 days, so explain why the deadline still applies.`,t=!0,n=!0;else if(E<0){let i=Math.abs(E);M=`This date is ${i} day${i===1?"":"s"} in the future. Share upcoming deadlines or hearing dates so we can plan accordingly.`,t=!0}h&&(M?(h.textContent=M,h.hidden=!1):(h.hidden=!0,h.textContent="")),T&&(T.hidden=!t),g&&(g.required=n)},ue=()=>{A.forEach(a=>{a.dataset.originalRequired==="true"&&(a.required=!0);let c=a.dataset.originalTabIndex??"";c?a.setAttribute("tabindex",c):a.removeAttribute("tabindex")})},Q=()=>{let a=e.querySelector("#form-error-live");return a||(a=document.createElement("div"),a.id="form-error-live",a.setAttribute("role","alert"),a.setAttribute("aria-live","assertive"),a.className="visually-hidden",e.appendChild(a)),a};b?.addEventListener("click",()=>{H(),V(),j(),e.reportValidity()&&(U(L+1),Y())}),S?.addEventListener("click",()=>{U(L-1),Y()}),x.forEach(a=>{a.addEventListener("change",()=>{H(),P()})}),k.forEach(a=>{a.addEventListener("change",()=>{V(),P()})}),m?.addEventListener("input",()=>{j(),P()}),m?.addEventListener("change",()=>{j(),P()}),e.addEventListener("submit",a=>{if(P(),V(),j(),H(),ue(),!e.checkValidity()){a.preventDefault();let c=e.querySelector(":invalid");if(c){let s=c.validationMessage,p=Q();p.textContent=s?`Error: ${s}`:"There is an error in the form.";let f=r.findIndex(E=>E.contains(c));f!==-1&&U(f,{focusField:!1}),window.requestAnimationFrame(()=>{c.reportValidity(),c.focus({preventScroll:!1})})}}},!0),e.addEventListener("reset",()=>{K(),window.requestAnimationFrame(()=>{U(0,{focusField:!1}),H(),V(),j()})}),e.addEventListener("enhanced:success",()=>{K(),e.reset(),U(0,{focusField:!1}),H(),V(),j()}),e.addEventListener("input",P),e.addEventListener("change",P);let X=()=>{H(),V(),j()};X(),de()?X():U(0,{focusField:!1})}var Ae=ae(()=>{});var Le={};oe(Le,{initShare:()=>Re});function Re(){let e=(d=20)=>{let v=window.matchMedia("(prefers-reduced-motion: reduce)").matches;navigator.vibrate&&!v&&navigator.vibrate(d)},r=document.getElementById("share-btn-native");r?.addEventListener("click",async d=>{d.preventDefault();let v={title:r.dataset.shareTitle,text:r.dataset.shareText,url:r.dataset.shareUrl};if(e(),navigator.share)try{await navigator.share(v)}catch{}else{let x=encodeURIComponent(v.url),k=encodeURIComponent(v.title);window.open(`https://twitter.com/intent/tweet?url=${x}&text=${k}`,"_blank")}}),document.getElementById("print-btn")?.addEventListener("click",d=>{d.preventDefault(),e(),window.print()}),document.getElementById("request-review-btn")?.addEventListener("click",()=>e());let b=document.querySelectorAll("form#secure-contact"),S=document.getElementById("cta-error");b.forEach(d=>{d.addEventListener("submit",async v=>{v.preventDefault();let x=new URLSearchParams(new FormData(d)).toString();try{let k=await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x});if(k.ok){e([20,50,20]),S?.style?.setProperty("display","none"),d.dispatchEvent(new CustomEvent("enhanced:success",{detail:{response:k}}));let $=d.dataset.successTarget,m=d.dataset.successMessage;if($){let h=document.querySelector($);if(h){d.setAttribute("hidden","true"),h.hidden=!1,h.focus?.();return}}m?d.innerHTML=`<p>${m}</p>`:d.innerHTML="<p>Thanks\u2014we'll be in touch soon.</p>"}else S?.style?.setProperty("display","block"),d.dispatchEvent(new CustomEvent("enhanced:error",{detail:{response:k}}))}catch(k){S?.style?.setProperty("display","block"),d.dispatchEvent(new CustomEvent("enhanced:error",{detail:{error:k}}))}})})}var Te=ae(()=>{});var Ie={};oe(Ie,{initFeedback:()=>Ne});function Ne(){let e=document.querySelectorAll("[data-feedback-form]");e.length&&e.forEach(r=>{let u=r.querySelector("[data-feedback-value]"),l=Array.from(r.querySelectorAll("[data-feedback-answer]"));if(!u||!l.length)return;let b=r.querySelector("[data-feedback-followup]"),S=r.querySelector("[data-feedback-textarea]"),d=r.querySelector("[data-feedback-submit]"),v=r.querySelector("[data-feedback-status]"),x=!1,k=()=>ee(v,"",null),$=g=>{l.forEach(A=>{let L=A===g;A.classList.toggle("is-selected",L),A.setAttribute("aria-pressed",L?"true":"false")})},m=()=>{b&&(b.hidden=!1),se(d,!1),S?.focus({preventScroll:!1})},h=({clear:g=!0}={})=>{b&&(b.hidden=!0),g&&S&&(S.value="")},T=async()=>{if(x)return;let g=u.value;if(!g){ee(v,"Choose Yes or No to send feedback.","is-error");return}let A=new FormData(r);A.set("feedback_rating",g),S&&A.set("feedback_details",S.value.trim()),A.set("page_title",document.title),A.set("page_url",window.location.href);let L=[window.location.pathname,window.location.search,window.location.hash].filter(Boolean);A.set("page_path",L.join("")),A.set("page_language",document.documentElement?.lang||""),A.set("referrer",document.referrer||""),A.set("user_agent",navigator.userAgent),A.set("submitted_at",new Date().toISOString());let N=_e(A),D=r.getAttribute("action"),I=D&&D.trim()?D:r.action||window.location.pathname;try{x=!0,xe(l,!0),se(d,!0),ee(v,"Sending feedback\u2026","is-pending");let F=await fetch(I,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:N});if(!F.ok)throw new Error(`Request failed with status ${F.status}`);ee(v,"Thanks for helping us improve this page.","is-success"),r.dataset.feedbackState="submitted",h()}catch(F){console.error("Feedback submission failed:",F),ee(v,"Sorry\u2014your feedback could not be sent. Please try again.","is-error"),xe(l,!1),se(d,!1)}finally{x=!1}};l.forEach(g=>{g.addEventListener("click",()=>{if(x)return;let A=g.dataset.feedbackAnswer;A&&(u.value=A,$(g),k(),A==="no"?m():(h(),T()))})}),r.addEventListener("submit",g=>{g.preventDefault(),!x&&(k(),T())})})}var _e,ee,se,xe,ke=ae(()=>{_e=e=>{let r=new URLSearchParams;for(let[u,l]of e.entries())typeof l=="string"&&r.append(u,l);return r.toString()},ee=(e,r,u)=>{e&&(e.textContent=r||"",e.classList.remove("is-success","is-error","is-pending"),u&&e.classList.add(u))},se=(e,r)=>{e&&(e.disabled=r,r?e.setAttribute("aria-disabled","true"):e.removeAttribute("aria-disabled"))},xe=(e,r)=>{e.forEach(u=>se(u,r))}});var Me={};oe(Me,{closeModal:()=>ce,initModals:()=>He});function He(){let e=document.querySelectorAll(".modal");e.length&&(Ue(),e.forEach(r=>{(!r.classList.contains("active")||r.hasAttribute("hidden"))&&(r.inert=!0),r.querySelector(".modal-close")?.addEventListener("click",()=>ce(r)),r.addEventListener("click",l=>{l.target===r&&ce(r)}),r.classList.contains("active")&&!r.hasAttribute("hidden")&&Ce(r)}))}var qe,Fe,ie,pe,he,Oe,Ce,ce,Ue,De=ae(()=>{qe=0,Fe=!1,ie=0,pe=new WeakMap,he=new WeakMap,Oe=e=>(e.id||(qe+=1,e.id=`modal-trigger-${qe}`),e.id),Ce=(e,r)=>{if(!e)return;if(r){let b=Oe(r);e.dataset.openerId=b}pe.set(e,document.activeElement instanceof HTMLElement?document.activeElement:null),e.removeAttribute("hidden"),e.classList.add("active"),document.body.classList.add("body--modal-open"),ie+=1,document.body.inert=!0,e.inert=!1,e.removeAttribute("inert");let u=e.querySelector("[data-initial-focus]")||e.querySelector(".modal-close")||e.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');u&&typeof u.focus=="function"&&u.focus();let l=b=>{b.key==="Escape"&&(b.preventDefault(),ce(e))};document.addEventListener("keydown",l,!0),he.set(e,l),e.setAttribute("aria-modal","true"),e.setAttribute("role","dialog")},ce=e=>{if(!e)return;let r=he.get(e);r&&(document.removeEventListener("keydown",r,!0),he.delete(e)),e.classList.remove("active"),e.setAttribute("hidden",""),document.body.classList.remove("body--modal-open"),ie=Math.max(0,ie-1),ie===0&&(document.body.inert=!1),e.inert=!0;let u=d=>{if(!d||typeof d.focus!="function"||!(typeof d.isConnected=="boolean"?d.isConnected:document.body.contains(d)))return!1;let x=d.hasAttribute("aria-hidden")||d.getAttribute("hidden")!==null,k="disabled"in d&&d.disabled,$=typeof d.getClientRects=="function"?d.getClientRects().length>0:d.offsetParent!==null;return!x&&!k&&$},l=()=>{let d=document.querySelector(".nav-links a");if(u(d)){d.focus();return}let v=document.querySelector("a[href], button:not([disabled])");u(v)&&v.focus()},b=e?.dataset?.openerId,S=b?document.getElementById(b):null;u(S)||(S=pe.get(e)),u(S)?S.focus():l(),e?.dataset&&delete e.dataset.openerId,pe.delete(e)},Ue=()=>{Fe||(Fe=!0,document.addEventListener("click",e=>{let r=e.target.closest("[data-modal-target]");if(!r)return;let u=r.dataset.modalTarget;if(!u)return;let l=document.getElementById(u);l&&(e.preventDefault(),Ce(l,r))}))}});var ve=()=>{let e;try{e=localStorage.getItem("theme")}catch{e=null}let r=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,u=e||(r?"dark":"light");document.documentElement.setAttribute("data-theme",u),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{let b;try{b=localStorage.getItem("theme")}catch{b=null}b||document.documentElement.setAttribute("data-theme",l.matches?"dark":"light")})};var fe=e=>{let r=document.createElement("template");return r.innerHTML=e.trim(),r.content.firstChild},we=e=>{let r=new Date(e);return isNaN(r.getTime())?"":r.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},be=(e,r)=>{let u;return function(...b){let S=()=>{clearTimeout(u),e(...b)};clearTimeout(u),u=setTimeout(S,r)}};var Be=e=>String(e??"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase();function Se(){let e=[],r=[],u="grid",l={search:"",category:"All Categories",type:"All Types"},b=12,S=0,d,v=null,x={query:"",results:null},k=0,$=0,m=document.getElementById("case-grid"),h=document.getElementById("search-input"),T=document.getElementById("category-filter"),g=document.getElementById("type-filter"),A=document.getElementById("view-toggle"),L=document.getElementById("filter-badges"),N=document.getElementById("reset-filters"),D=document.getElementById("results-count"),I=document.createElement("button"),F=document.querySelector(".nav"),O=document.querySelector(".nav-toggle"),W=document.getElementById("primary-nav");D&&(D.setAttribute("role","status"),D.setAttribute("aria-live","polite")),I.className="btn btn-outline-blue",I.textContent="Load More",I.style.display="none",I.style.margin="32px auto",F&&O&&W&&(O.addEventListener("click",()=>{let t=O.getAttribute("aria-expanded")==="true";O.setAttribute("aria-expanded",String(!t)),F.classList.toggle("nav--open",!t),t?O.focus():(W.querySelector('[aria-current="page"], .is-active')||W.querySelector("a"))?.focus()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&F.classList.contains("nav--open")&&(O.setAttribute("aria-expanded","false"),F.classList.remove("nav--open"),O.focus())}));let R=!1,G=()=>typeof document<"u"&&typeof document.startViewTransition=="function",te=t=>{if(!t)return;let n=()=>{window.location.href=t};if(!G()){n();return}try{document.startViewTransition(n)}catch(i){console.warn("View transition navigation failed, falling back to hard navigation.",i),n()}},J=()=>{!m||R||(R=!0,m.addEventListener("click",t=>{if(t.defaultPrevented||t.button!==0||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)return;let n=t.target.closest("a");if(!n||!m.contains(n)||n.hasAttribute("download")||n.target&&n.target!=="_self")return;let i;try{i=new URL(n.getAttribute("href")||"",window.location.href)}catch{return}i.origin===window.location.origin&&(t.preventDefault(),te(i.toString()))}))};if(h){let t=()=>{requestAnimationFrame(()=>{if(h)try{h.focus({preventScroll:!0})}catch{h.focus()}})};(()=>{if(window.location.hash==="#search-input")return!0;try{return new URLSearchParams(window.location.search).get("focus")==="search"}catch{return!1}})()&&t(),window.addEventListener("hashchange",()=>{window.location.hash==="#search-input"&&t()})}let B=t=>t.category?.includes("Finance")||t.category?.includes("Campaign")?"Financial Violation":t.category?.includes("MOU")||t.category?.includes("DNC")?"Procedural Violation":t.category?.includes("Bylaw")||t.category?.includes("Charter")?"Governance Failure":"Other",le=t=>{let n=B(t).toLowerCase();return n.includes("financial")?"financial":n.includes("procedural")?"procedural":n.includes("governance")?"governance":"other"},re=t=>Be(t),Y=(t={})=>t.slug?t.slug:t.case_id?re(t.case_id):"",P=(t={})=>{let n=t?.overproof?.slug,i=Y(t);return!n||!i?(console.warn("Missing slug data for proof URL",{caseId:t?.case_id,proofSlug:i,overproofSlug:n}),"#"):`/proofs/${n}/${i}/`},K=(t="")=>{if(!t)return"";try{let n=typeof window<"u"&&window.location?window.location.origin:"https://democraticjustice.org",o=new URL(t,n).pathname||"";return o=o.replace(/index\.html$/i,""),o.endsWith("/")||(o=`${o}/`),o.replace(/\/+$/,"/")}catch(n){return console.warn("Failed to normalize URL for search matching",{url:t,error:n}),t}},de=(t={})=>K(P(t)),Z=()=>v||(typeof window.pagefindInit!="function"?(v=Promise.resolve(null),v):(v=window.pagefindInit({baseUrl:"/pagefind/"}).catch(t=>(console.error("Failed to initialize Pagefind search index:",t),null)),v)),ne=async t=>{if(!t)return null;let n=await Z();if(!n||typeof n.search!="function")return null;try{let i=await n.search(t),o=Array.isArray(i?.results)?i.results:[],y=new Set;return o.length&&(await Promise.allSettled(o.map(q=>typeof q?.data=="function"?q.data():Promise.resolve(null)))).forEach(q=>{q.status==="fulfilled"&&q.value&&q.value.url&&y.add(K(q.value.url))}),{urls:y,count:o.length}}catch(i){return console.error("Pagefind search failed:",i),null}},U=()=>typeof IntersectionObserver!="function"?null:new IntersectionObserver((t,n)=>{t.forEach(i=>{if(!i.isIntersecting)return;let o=i.target,y=o.getAttribute("data-srcset"),w=o.getAttribute("data-src");y&&(o.setAttribute("srcset",y),o.removeAttribute("data-srcset")),w&&(o.setAttribute("src",w),o.removeAttribute("data-src")),n.unobserve(o)})},{rootMargin:"50px"}),H=()=>{if(!L)return;let t=[];l.search&&t.push(`
                <span class="filter-badge" data-filter="search">
                    Search: "${l.search}"
                    <button class="badge-remove" aria-label="Remove search filter">\xD7</button>
                </span>
            `),l.category!=="All Categories"&&t.push(`
                <span class="filter-badge" data-filter="category">
                    ${l.category}
                    <button class="badge-remove" aria-label="Remove category filter">\xD7</button>
                </span>
            `),l.type!=="All Types"&&t.push(`
                <span class="filter-badge" data-filter="type">
                    ${l.type}
                    <button class="badge-remove" aria-label="Remove type filter">\xD7</button>
                </span>
            `),L.innerHTML=t.join(""),L.querySelectorAll(".badge-remove").forEach(n=>{n.addEventListener("click",i=>{let o=i.target.parentElement.dataset.filter;o==="search"?(l.search="",h&&(h.value="")):o==="category"?(l.category="All Categories",T&&(T.value="All Categories")):o==="type"&&(l.type="All Types",g&&(g.value="All Types")),c()})})},V=t=>{let n=P(t),i=B(t),o=le(t),y=t.category||i,w=t?.overproof?.url||(t?.overproof?.slug?`/briefs/${t.overproof.slug}/`:""),q=K(w),z=!!q,C=[];y&&C.push(y),t.date&&C.push(we(t.date)),z&&C.push("Case file available");let _=C.join(" \u2022 ");return`
            <a class="proof-row"
               href="${n}"
               data-category="${o}"
               data-proof-id="${t.case_id||t.slug}"
               ${z?`data-case-url="${q}"`:""}>
                <div class="proof-row__id">${t.case_id??""}</div>
                <div class="proof-row__content">
                    <h3 class="proof-row__title">${t.title}</h3>
                    <p class="proof-row__meta">${_}</p>
                </div>
                <span class="proof-row__badge ${o?`${o}-violation`:""}">${y||"Other"}</span>
                <svg class="proof-row__action" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                    <path d="M7 5l5 5-5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </a>`},j=t=>{if(!m)return;if(m.className="proof-list__body timeline-view",m.innerHTML="",!t||t.length===0){m.innerHTML='<p style="text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>';return}let n={};t.forEach(o=>{let y=new Date(o.date),w=`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`;n[w]||(n[w]=[]),n[w].push(o)}),Object.keys(n).sort().reverse().forEach(o=>{let[y,w]=o.split("-"),z=`
                <div class="timeline-month">
                    <h3 class="timeline-month-header">${new Date(y,w-1).toLocaleDateString("en",{month:"long",year:"numeric"})}</h3>
                    <div class="timeline-entries">
                        ${n[o].map(C=>`
                            <div class="timeline-entry">
                                <div class="timeline-date">${new Date(C.date).getDate()}</div>
                                <div class="timeline-content">
                                    <span class="timeline-category">${C.category}</span>
                                    <h4><a href="${P(C)}">${C.title}</a></h4>
                                    <p>${C.thesis}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;m.appendChild(fe(z))})},ue=(t,n=!1)=>{if(!m)return;if(n||(m.className="proof-list__body",m.innerHTML="",S=0),!t||t.length===0){m.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>',I.style.display="none";return}let i=S,o=Math.min(i+b,t.length);t.slice(i,o).forEach(w=>{let q=V(w),z=fe(q);if(!z)return;m.appendChild(z);let C=z.querySelectorAll("img[data-src], source[data-srcset]");C.length!==0&&(d?C.forEach(_=>d.observe(_)):C.forEach(_=>{let me=_.getAttribute("data-srcset"),ye=_.getAttribute("data-src");me&&(_.setAttribute("srcset",me),_.removeAttribute("data-srcset")),ye&&(_.setAttribute("src",ye),_.removeAttribute("data-src"))}))}),S=o,S<t.length?(I.style.display="block",m.parentElement.contains(I)||m.parentElement.appendChild(I)):I.style.display="none"},Q=(t,n=!1)=>{u==="timeline"?j(t):ue(t,n)},X=()=>{if(!D)return;let t=e.length,n=r.length;D.textContent=n===t?`Showing all ${t} proofs`:`Showing ${n} of ${t} proofs`},ge=be(t=>{!t||!t.query||typeof fetch=="function"&&fetch("/.netlify/functions/log-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(n=>{console.error("Failed to send search analytics payload",n)})},500),a=(t,n,i={})=>{if(!t)return;let o=String(t).trim(),y=Number.isFinite(Number(n))?Number(n):0,w=Date.now();x.query===o&&x.results===y&&w-k<6e4||(x={query:o,results:y},k=w,ge({query:o,results:y,...i}))},c=async(t=!1)=>{let n=++$;l.search=h?h.value:"",l.category=T?T.value:"All Categories",l.type=g?g.value:"All Types";let i=l.search?l.search.trim():"",o=null;if(i&&(o=await ne(i)),n!==$)return;let y=i.toLowerCase();r=e.filter(w=>{if(l.category!=="All Categories"&&w.category!==l.category||l.type!=="All Types"&&B(w)!==l.type)return!1;if(i){if(o){let q=de(w);if(!q||!o.urls?.has(q))return!1}else if(![w.title,w.thesis,w.stakes,w.violation,w.rule_summary,w.case_id,w.category].join(" ").toLowerCase().includes(y))return!1}return!0}),Q(r),X(),H(),t&&i&&a(i,r.length,{filters:{category:l.category,type:l.type},pagefindResults:o?.count??null,strategy:o?"pagefind":"local",triggeredAt:new Date().toISOString()})},s=null,p=async()=>{s=null,D&&h&&h.value.trim()&&(D.innerHTML='<span class="loading-indicator"><span class="loading-indicator__label">Searching</span><span class="loading-dots" aria-hidden="true"><span></span><span></span><span></span></span></span>'),await c(!0)},f=()=>{s!==null&&typeof cancelAnimationFrame=="function"&&(cancelAnimationFrame(s),s=null),typeof requestAnimationFrame=="function"?s=requestAnimationFrame(()=>{p()}):p()},E=()=>{if(T){let t=["All Categories",...new Set(e.map(n=>n.category).filter(Boolean))];T.innerHTML="",t.forEach(n=>{let i=document.createElement("option");i.value=n,i.textContent=n,T.appendChild(i)})}if(g){let t=["All Types",...new Set(e.map(n=>B(n)))];g.innerHTML="",t.forEach(n=>{let i=document.createElement("option");i.value=n,i.textContent=n,g.appendChild(i)})}};(()=>{try{d=U();let t=document.getElementById("proof-data");if(!m||!t)return;J();let n=(t.textContent||"").trim();if(!n)throw new Error("Proof data element is empty.");let i;try{i=JSON.parse(n)}catch{throw new Error("Proof data JSON is invalid.")}let o;if(Array.isArray(i?.proofs))o=i.proofs;else if(Array.isArray(i))o=i;else throw new Error("Unrecognized proof data format.");e=o.filter(y=>y&&y.title),r=[...e],E(),Q(r),X(),H(),Z(),h&&h.addEventListener("input",f),T&&T.addEventListener("change",c),g&&g.addEventListener("change",c),A&&A.addEventListener("click",()=>{u=u==="grid"?"timeline":"grid",A.textContent=u==="grid"?"Timeline View":"Grid View",Q(r)}),I.addEventListener("click",()=>{Q(r,!0)}),N&&N.addEventListener("click",()=>{l={search:"",category:"All Categories",type:"All Types"},h&&(h.value=""),T&&(T.value="All Categories"),g&&(g.value="All Types"),c()})}catch(t){console.error("Error initializing archive:",t),m&&(m.innerHTML='<p style="grid-column:1/-1; text-align:center; padding:40px; color:red;">Could not load proofs. Please try again later.</p>')}})()}ve();document.addEventListener("DOMContentLoaded",()=>{Se(),document.querySelector("[data-form-id]")&&Promise.resolve().then(()=>(Ae(),Ee)).then(e=>e.initReviewForm()).catch(e=>console.error("Failed to load review form module",e)),(document.getElementById("share-btn-native")||document.getElementById("print-btn")||document.querySelector("form#secure-contact"))&&Promise.resolve().then(()=>(Te(),Le)).then(e=>e.initShare()).catch(e=>console.error("Failed to load share module",e)),document.querySelector("[data-feedback-form]")&&Promise.resolve().then(()=>(ke(),Ie)).then(e=>e.initFeedback()).catch(e=>console.error("Failed to load feedback module",e)),document.querySelector(".modal")&&Promise.resolve().then(()=>(De(),Me)).then(e=>e.initModals()).catch(e=>console.error("Failed to load modals module",e))});"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(e=>{console.error("Service worker registration failed:",e)});})();

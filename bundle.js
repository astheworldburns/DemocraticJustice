(()=>{var Ie=Object.defineProperty;var ee=(t,n)=>()=>(t&&(n=t(t=0)),n);var te=(t,n)=>{for(var d in n)Ie(t,d,{get:n[d],enumerable:!0})};var pe={};te(pe,{initReviewForm:()=>ke});function ke(){let t=document.querySelector('[data-form-id="challenge-review"]');if(!t)return;let n=Array.from(t.querySelectorAll("[data-form-step]"));if(!n.length)return;let d=Array.from(t.querySelectorAll("[data-progress-step]")),c=t.querySelector("[data-progress-status]"),v=t.querySelector("[data-form-next]"),l=t.querySelector("[data-form-prev]"),u=t.querySelector("[data-form-submit]"),m=t.querySelector("[data-registration-explanation]"),E=m?.querySelector("textarea"),x=t.querySelectorAll('input[name="wv-registered"]'),$=t.querySelectorAll('input[name="prior-remedy"]'),w=t.querySelectorAll("[data-prior-remedy]"),g=t.querySelector("#decision-date"),b=t.querySelector("[data-date-warning]"),f=t.querySelector("[data-deadline-notes]"),p=f?.querySelector("textarea"),M=Array.from(t.querySelectorAll("input, select, textarea"));M.forEach(e=>{if(e.hasAttribute("required")&&(e.dataset.originalRequired="true"),!("originalTabIndex"in e.dataset)){let r=e.getAttribute("tabindex");r!==null?e.dataset.originalTabIndex=r:e.dataset.originalTabIndex=""}});let A=0,T="reviewFormState",F=(()=>{if(typeof window>"u")return{type:"none",getItem:()=>null,setItem:()=>{},removeItem:()=>{}};try{let{sessionStorage:a}=window;if(a){let s=`${T}__test`;return a.setItem(s,"1"),a.removeItem(s),{type:"session",getItem:o=>a.getItem(o),setItem:(o,i)=>a.setItem(o,i),removeItem:o=>a.removeItem(o)}}}catch(a){console.warn("Session storage is unavailable; attempting alternative persistence.",a)}if(typeof window.history<"u"&&typeof window.history.replaceState=="function")return{type:"history",getItem:a=>{let s=window.history.state;if(!s||typeof s!="object")return null;let o=s[a];return typeof o=="string"?o:null},setItem:(a,s)=>{try{let o=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};o[a]=s,window.history.replaceState(o,document.title)}catch(o){console.warn("Failed to persist form state with the History API.",o)}},removeItem:a=>{try{let s=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};a in s&&(delete s[a],window.history.replaceState(s,document.title))}catch(s){console.warn("Failed to clear form state from the History API.",s)}}};let r={};return console.warn("Falling back to in-memory form persistence; progress will be lost if the page reloads."),{type:"memory",getItem:a=>Object.prototype.hasOwnProperty.call(r,a)?r[a]:null,setItem:(a,s)=>{r[a]=s},removeItem:a=>{delete r[a]}}})(),q=F.type!=="none",V=F.type==="memory",O="You have unsaved changes. Leave anyway?",B=!1,j=!1,Y=e=>{if(B)return e.preventDefault(),e.returnValue=O,O},N=()=>{!V||typeof window>"u"||(B&&!j?(window.addEventListener("beforeunload",Y),j=!0):!B&&j&&(window.removeEventListener("beforeunload",Y),j=!1))},D=null,ae=e=>typeof RadioNodeList<"u"&&e instanceof RadioNodeList,G=e=>{let r=Object.values(e||{});return A>0||r.some(a=>Array.isArray(a)?a.some(s=>String(s??"").trim()!==""):String(a??"").trim()!=="")},K=()=>{if(q)try{let e=new FormData(t),r={};e.forEach((o,i)=>{if(i)if(Object.prototype.hasOwnProperty.call(r,i)){let h=r[i];r[i]=Array.isArray(h)?[...h,o]:[h,o]}else r[i]=o});let s=JSON.stringify({currentStep:A,data:r});F.setItem(T,s),B=G(r),N()}catch(e){console.warn("Failed to save form state:",e),B=!1,N()}},P=()=>{q&&(typeof window<"u"?(window.clearTimeout(D),D=window.setTimeout(()=>{K(),D=null},200)):K())},z=()=>{if(q){try{F.removeItem(T)}catch(e){console.warn("Failed to clear saved form state:",e)}typeof window<"u"&&D!==null&&(window.clearTimeout(D),D=null),B=!1,N()}},se=()=>{if(!q)return!1;let e="";try{e=F.getItem(T)||""}catch(i){return console.warn("Failed to read saved form state:",i),!1}if(!e)return!1;let r;try{r=JSON.parse(e)}catch(i){return console.warn("Corrupt saved form state detected; clearing.",i),z(),!1}if(!r||typeof r!="object")return!1;let{currentStep:a=0,data:s={}}=r;Object.entries(s).forEach(([i,h])=>{if(!i)return;let S=t.elements[i];if(!S)return;let y=Array.isArray(h)?h:[h];if(ae(S)){Array.from(S).forEach(L=>{L.checked=y.includes(L.value)});return}let I=L=>{if(L){if(L.type==="checkbox"){L.checked=y.includes(L.value)||!L.value&&y.includes("on");return}if(L.type==="radio"){L.checked=y.includes(L.value);return}if(L.type==="select-multiple"){Array.from(L.options).forEach(W=>{W.selected=y.includes(W.value)});return}typeof L.value=="string"&&(L.value=y[y.length-1]??"")}};typeof S.length=="number"&&!S.tagName?Array.from(S).forEach(I):I(S)});let o=Number.isInteger(a)?Math.min(Math.max(a,0),n.length-1):0;return C(o,{focusField:!1}),B=G(s),N(),!0},Q=()=>{n.forEach((e,r)=>{let a=r===A;e.hidden=!a,e.classList.toggle("is-active",a),e.setAttribute("aria-hidden",a?"false":"true"),e.querySelectorAll("input, select, textarea").forEach(o=>{if(o.type!=="hidden")if(o.dataset.originalRequired==="true"&&(o.required=a),a){let i=o.dataset.originalTabIndex??"";i?o.setAttribute("tabindex",i):o.removeAttribute("tabindex")}else o.setAttribute("tabindex","-1")})}),d.forEach((e,r)=>{let a=r===A;e.classList.toggle("is-active",a),e.classList.toggle("is-complete",r<A),e.setAttribute("aria-current",a?"step":"false")}),c&&(c.textContent=`Step ${A+1} of ${n.length}`),l&&(l.disabled=A===0),v&&(v.hidden=A===n.length-1),u&&(u.hidden=A!==n.length-1)},Z=()=>{let e=n[A];if(!e)return;let r=e.querySelector('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])');r&&r.focus({preventScroll:!1})},C=(e,{focusField:r=!0}={})=>{let a=Math.min(Math.max(e,0),n.length-1);if(a===A){Q(),r&&window.requestAnimationFrame(Z);return}A=a,Q(),r&&window.requestAnimationFrame(Z)},R=()=>{if(!m)return;let r=t.querySelector('input[name="wv-registered"]:checked')?.value==="no";m.hidden=!r,E&&(E.required=!!r)},H=()=>{let e=t.querySelector('input[name="prior-remedy"]:checked')?.value;w.forEach(r=>{let a=e&&r.dataset.priorRemedy===e;r.hidden=!a;let s=r.querySelector("textarea");s&&(s.required=a&&e==="yes")})},_=()=>{if(!g)return;let e=g.value;if(!e){b&&(b.hidden=!0,b.textContent=""),f&&(f.hidden=!0),p&&(p.required=!1);return}let r=new Date(`${e}T00:00:00`);if(Number.isNaN(r.getTime()))return;let a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()-r.getTime(),i=Math.floor(o/864e5),h="",S=!1,y=!1;if(i>30)h=`This date is ${i} days old. WVSDEC filings must arrive within 30 days, so explain why the deadline still applies.`,S=!0,y=!0;else if(i<0){let I=Math.abs(i);h=`This date is ${I} day${I===1?"":"s"} in the future. Share upcoming deadlines or hearing dates so we can plan accordingly.`,S=!0}b&&(h?(b.textContent=h,b.hidden=!1):(b.hidden=!0,b.textContent="")),f&&(f.hidden=!S),p&&(p.required=y)},U=()=>{M.forEach(e=>{e.dataset.originalRequired==="true"&&(e.required=!0);let r=e.dataset.originalTabIndex??"";r?e.setAttribute("tabindex",r):e.removeAttribute("tabindex")})},oe=()=>{let e=t.querySelector("#form-error-live");return e||(e=document.createElement("div"),e.id="form-error-live",e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.className="visually-hidden",t.appendChild(e)),e};v?.addEventListener("click",()=>{R(),H(),_(),t.reportValidity()&&(C(A+1),K())}),l?.addEventListener("click",()=>{C(A-1),K()}),x.forEach(e=>{e.addEventListener("change",()=>{R(),P()})}),$.forEach(e=>{e.addEventListener("change",()=>{H(),P()})}),g?.addEventListener("input",()=>{_(),P()}),g?.addEventListener("change",()=>{_(),P()}),t.addEventListener("submit",e=>{if(P(),R(),H(),_(),U(),!t.checkValidity()){e.preventDefault();let r=t.querySelector(":invalid");if(r){let a=r.validationMessage,s=oe();s.textContent=a?`Error: ${a}`:"There is an error in the form.";let o=n.findIndex(i=>i.contains(r));o!==-1&&C(o,{focusField:!1}),window.requestAnimationFrame(()=>{r.reportValidity(),r.focus({preventScroll:!1})})}}},!0),t.addEventListener("reset",()=>{z(),window.requestAnimationFrame(()=>{C(0,{focusField:!1}),R(),H(),_()})}),t.addEventListener("enhanced:success",()=>{z(),t.reset(),C(0,{focusField:!1}),R(),H(),_()}),t.addEventListener("input",P),t.addEventListener("change",P);let X=()=>{R(),H(),_()};X(),se()?X():C(0,{focusField:!1})}var me=ee(()=>{});var ge={};te(ge,{initShare:()=>qe});function qe(){let t=(u=20)=>{let m=window.matchMedia("(prefers-reduced-motion: reduce)").matches;navigator.vibrate&&!m&&navigator.vibrate(u)},n=document.getElementById("share-btn-native");n?.addEventListener("click",async u=>{u.preventDefault();let m={title:n.dataset.shareTitle,text:n.dataset.shareText,url:n.dataset.shareUrl};if(t(),navigator.share)try{await navigator.share(m)}catch{}else{let E=encodeURIComponent(m.url),x=encodeURIComponent(m.title);window.open(`https://twitter.com/intent/tweet?url=${E}&text=${x}`,"_blank")}}),document.getElementById("print-btn")?.addEventListener("click",u=>{u.preventDefault(),t(),window.print()}),document.getElementById("request-review-btn")?.addEventListener("click",()=>t());let v=document.querySelectorAll("form#secure-contact"),l=document.getElementById("cta-error");v.forEach(u=>{u.addEventListener("submit",async m=>{m.preventDefault();let E=new URLSearchParams(new FormData(u)).toString();try{let x=await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:E});if(x.ok){t([20,50,20]),l?.style?.setProperty("display","none"),u.dispatchEvent(new CustomEvent("enhanced:success",{detail:{response:x}}));let $=u.dataset.successTarget,w=u.dataset.successMessage;if($){let g=document.querySelector($);if(g){u.setAttribute("hidden","true"),g.hidden=!1,g.focus?.();return}}w?u.innerHTML=`<p>${w}</p>`:u.innerHTML="<p>Thanks\u2014we'll be in touch soon.</p>"}else l?.style?.setProperty("display","block"),u.dispatchEvent(new CustomEvent("enhanced:error",{detail:{response:x}}))}catch(x){l?.style?.setProperty("display","block"),u.dispatchEvent(new CustomEvent("enhanced:error",{detail:{error:x}}))}})})}var ye=ee(()=>{});var be={};te(be,{initFeedback:()=>Me});function Me(){let t=document.querySelectorAll("[data-feedback-form]");t.length&&t.forEach(n=>{let d=n.querySelector("[data-feedback-value]"),c=Array.from(n.querySelectorAll("[data-feedback-answer]"));if(!d||!c.length)return;let v=n.querySelector("[data-feedback-followup]"),l=n.querySelector("[data-feedback-textarea]"),u=n.querySelector("[data-feedback-submit]"),m=n.querySelector("[data-feedback-status]"),E=!1,x=()=>J(m,"",null),$=f=>{c.forEach(p=>{let M=p===f;p.classList.toggle("is-selected",M),p.setAttribute("aria-pressed",M?"true":"false")})},w=()=>{v&&(v.hidden=!1),re(u,!1),l?.focus({preventScroll:!1})},g=({clear:f=!0}={})=>{v&&(v.hidden=!0),f&&l&&(l.value="")},b=async()=>{if(E)return;let f=d.value;if(!f){J(m,"Choose Yes or No to send feedback.","is-error");return}let p=new FormData(n);p.set("feedback_rating",f),l&&p.set("feedback_details",l.value.trim()),p.set("page_title",document.title),p.set("page_url",window.location.href);let M=[window.location.pathname,window.location.search,window.location.hash].filter(Boolean);p.set("page_path",M.join("")),p.set("page_language",document.documentElement?.lang||""),p.set("referrer",document.referrer||""),p.set("user_agent",navigator.userAgent),p.set("submitted_at",new Date().toISOString());let A=Ce(p),T=n.getAttribute("action"),k=T&&T.trim()?T:n.action||window.location.pathname;try{E=!0,ve(c,!0),re(u,!0),J(m,"Sending feedback\u2026","is-pending");let F=await fetch(k,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:A});if(!F.ok)throw new Error(`Request failed with status ${F.status}`);J(m,"Thanks for helping us improve this page.","is-success"),n.dataset.feedbackState="submitted",g()}catch(F){console.error("Feedback submission failed:",F),J(m,"Sorry\u2014your feedback could not be sent. Please try again.","is-error"),ve(c,!1),re(u,!1)}finally{E=!1}};c.forEach(f=>{f.addEventListener("click",()=>{if(E)return;let p=f.dataset.feedbackAnswer;p&&(d.value=p,$(f),x(),p==="no"?w():(g(),b()))})}),n.addEventListener("submit",f=>{f.preventDefault(),!E&&(x(),b())})})}var Ce,J,re,ve,we=ee(()=>{Ce=t=>{let n=new URLSearchParams;for(let[d,c]of t.entries())typeof c=="string"&&n.append(d,c);return n.toString()},J=(t,n,d)=>{t&&(t.textContent=n||"",t.classList.remove("is-success","is-error","is-pending"),d&&t.classList.add(d))},re=(t,n)=>{t&&(t.disabled=n,n?t.setAttribute("aria-disabled","true"):t.removeAttribute("aria-disabled"))},ve=(t,n)=>{t.forEach(d=>re(d,n))}});var Le={};te(Le,{closeModal:()=>ne,initModals:()=>Pe});function Pe(){let t=document.querySelectorAll(".modal");t.length&&(Be(),t.forEach(n=>{let d=de(n);n.querySelector(".modal-close")?.addEventListener("click",()=>ne(n)),n.addEventListener("click",v=>{v.target===n&&ne(n)}),n.classList.contains("active")&&!n.hasAttribute("hidden")&&d.activate()}))}var le,Se,Ee,Ae,de,De,$e,ne,Be,xe=ee(()=>{le=class{constructor(n){this.element=n,this.focusableElements=null,this.firstFocusable=null,this.lastFocusable=null,this.active=!1,this.boundKeyHandler=null,this.previouslyFocusedElement=null}activate(){if(this.active)return;let n=document.activeElement;n&&typeof n.focus=="function"?this.previouslyFocusedElement=n:this.previouslyFocusedElement=null,this.focusableElements=this.element.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select, [tabindex]:not([tabindex="-1"])'),this.firstFocusable=this.focusableElements[0]||null,this.lastFocusable=this.focusableElements[this.focusableElements.length-1]||null,this.boundKeyHandler||(this.boundKeyHandler=this.handleKeyDown.bind(this)),this.element.addEventListener("keydown",this.boundKeyHandler),this.firstFocusable?.focus(),this.active=!0}deactivate(){if(!this.active)return;this.boundKeyHandler&&this.element.removeEventListener("keydown",this.boundKeyHandler);let n=this.element,d=()=>{let l=document.querySelector(".nav-links a");if(l&&typeof l.focus=="function"){l.focus();return}let u=document.querySelector("a[href], button:not([disabled])");u&&typeof u.focus=="function"&&u.focus()},c=l=>{if(!l||typeof l.focus!="function"||!(typeof l.isConnected=="boolean"?l.isConnected:document.body.contains(l)))return!1;let m=l.hasAttribute("aria-hidden")||l.getAttribute("hidden")!==null,E="disabled"in l&&l.disabled,x=typeof l.getClientRects=="function"?l.getClientRects().length>0:l.offsetParent!==null;return!m&&!E&&x},v=n?.dataset?.openerId;if(v){let l=document.getElementById(v);c(l)?l.focus():c(this.previouslyFocusedElement)?this.previouslyFocusedElement.focus():d()}else c(this.previouslyFocusedElement)?this.previouslyFocusedElement.focus():d();n?.dataset&&delete n.dataset.openerId,this.previouslyFocusedElement=null,this.active=!1}handleKeyDown(n){if(n.key==="Tab"&&(n.shiftKey?document.activeElement===this.firstFocusable&&(n.preventDefault(),this.lastFocusable?.focus()):document.activeElement===this.lastFocusable&&(n.preventDefault(),this.firstFocusable?.focus())),n.key==="Escape"){let d=this.element.closest(".modal");d&&ne(d)}}},Se=new WeakMap,Ee=0,Ae=!1,de=t=>{let n=Se.get(t);return n||(n=new le(t),Se.set(t,n)),n},De=t=>(t.id||(Ee+=1,t.id=`modal-trigger-${Ee}`),t.id),$e=(t,n)=>{if(n){let c=De(n);t.dataset.openerId=c}t.removeAttribute("hidden"),t.classList.add("active"),document.body.classList.add("body--modal-open"),de(t).activate(),t.setAttribute("aria-modal","true"),t.setAttribute("role","dialog")},ne=t=>{de(t).deactivate(),t.classList.remove("active"),t.setAttribute("hidden",""),document.body.classList.remove("body--modal-open")},Be=()=>{Ae||(Ae=!0,document.addEventListener("click",t=>{let n=t.target.closest("[data-modal-target]");if(!n)return;let d=n.dataset.modalTarget;if(!d)return;let c=document.getElementById(d);c&&(t.preventDefault(),$e(c,n))}))}});var ue=()=>{let t;try{t=localStorage.getItem("theme")}catch{t=null}let n=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,d=t||(n?"dark":"light");document.documentElement.setAttribute("data-theme",d),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",c=>{let v;try{v=localStorage.getItem("theme")}catch{v=null}v||document.documentElement.setAttribute("data-theme",c.matches?"dark":"light")})};var ie=t=>{let n=document.createElement("template");return n.innerHTML=t.trim(),n.content.firstChild},fe=t=>{let n=new Date(t);return isNaN(n.getTime())?"":n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},ce=(t,n)=>{let d;return function(...v){let l=()=>{clearTimeout(d),t(...v)};clearTimeout(d),d=setTimeout(l,n)}};var Fe=t=>String(t??"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase();function he(){let t=[],n=[],d="grid",c={search:"",category:"All Categories",type:"All Types"},v=12,l=0,u,m=null,E={query:"",results:null},x=0,$=0,w=document.getElementById("case-grid"),g=document.getElementById("search-input"),b=document.getElementById("category-filter"),f=document.getElementById("type-filter"),p=document.getElementById("view-toggle"),M=document.getElementById("filter-badges"),A=document.getElementById("reset-filters"),T=document.getElementById("results-count"),k=document.createElement("button"),F=document.querySelector(".nav"),q=document.querySelector(".nav-toggle"),V=document.getElementById("primary-nav");if(T&&(T.setAttribute("role","status"),T.setAttribute("aria-live","polite")),k.className="btn btn-outline-blue",k.textContent="Load More",k.style.display="none",k.style.margin="32px auto",F&&q&&V&&(q.addEventListener("click",()=>{let e=q.getAttribute("aria-expanded")==="true";q.setAttribute("aria-expanded",String(!e)),F.classList.toggle("nav--open",!e),e?q.focus():(V.querySelector('[aria-current="page"], .is-active')||V.querySelector("a"))?.focus()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&F.classList.contains("nav--open")&&(q.setAttribute("aria-expanded","false"),F.classList.remove("nav--open"),q.focus())})),g){let e=()=>{requestAnimationFrame(()=>{if(g)try{g.focus({preventScroll:!0})}catch{g.focus()}})};(()=>{if(window.location.hash==="#search-input")return!0;try{return new URLSearchParams(window.location.search).get("focus")==="search"}catch{return!1}})()&&e(),window.addEventListener("hashchange",()=>{window.location.hash==="#search-input"&&e()})}let O=e=>e.category?.includes("Finance")||e.category?.includes("Campaign")?"Financial Violation":e.category?.includes("MOU")||e.category?.includes("DNC")?"Procedural Violation":e.category?.includes("Bylaw")||e.category?.includes("Charter")?"Governance Failure":"Other",B=e=>{let r=O(e).toLowerCase();return r.includes("financial")?"financial":r.includes("procedural")?"procedural":r.includes("governance")?"governance":"other"},j=e=>Fe(e),Y=(e={})=>e.slug?e.slug:e.case_id?j(e.case_id):"",N=(e={})=>{let r=e?.overproof?.slug,a=Y(e);return!r||!a?(console.warn("Missing slug data for proof URL",{caseId:e?.case_id,proofSlug:a,overproofSlug:r}),"#"):`/proofs/${r}/${a}/`},D=(e="")=>{if(!e)return"";try{let r=typeof window<"u"&&window.location?window.location.origin:"https://democraticjustice.org",s=new URL(e,r).pathname||"";return s=s.replace(/index\.html$/i,""),s.endsWith("/")||(s=`${s}/`),s.replace(/\/+$/,"/")}catch(r){return console.warn("Failed to normalize URL for search matching",{url:e,error:r}),e}},ae=(e={})=>D(N(e)),G=()=>m||(typeof window.pagefindInit!="function"?(m=Promise.resolve(null),m):(m=window.pagefindInit({baseUrl:"/pagefind/"}).catch(e=>(console.error("Failed to initialize Pagefind search index:",e),null)),m)),K=async e=>{if(!e)return null;let r=await G();if(!r||typeof r.search!="function")return null;try{let a=await r.search(e),s=Array.isArray(a?.results)?a.results:[],o=new Set;return s.length&&(await Promise.allSettled(s.map(h=>typeof h?.data=="function"?h.data():Promise.resolve(null)))).forEach(h=>{h.status==="fulfilled"&&h.value&&h.value.url&&o.add(D(h.value.url))}),{urls:o,count:s.length}}catch(a){return console.error("Pagefind search failed:",a),null}},P=()=>typeof IntersectionObserver!="function"?null:new IntersectionObserver((e,r)=>{e.forEach(a=>{if(!a.isIntersecting)return;let s=a.target,o=s.getAttribute("data-srcset"),i=s.getAttribute("data-src");o&&(s.setAttribute("srcset",o),s.removeAttribute("data-srcset")),i&&(s.setAttribute("src",i),s.removeAttribute("data-src")),r.unobserve(s)})},{rootMargin:"50px"}),z=()=>{if(!M)return;let e=[];c.search&&e.push(`
                <span class="filter-badge" data-filter="search">
                    Search: "${c.search}"
                    <button class="badge-remove" aria-label="Remove search filter">\xD7</button>
                </span>
            `),c.category!=="All Categories"&&e.push(`
                <span class="filter-badge" data-filter="category">
                    ${c.category}
                    <button class="badge-remove" aria-label="Remove category filter">\xD7</button>
                </span>
            `),c.type!=="All Types"&&e.push(`
                <span class="filter-badge" data-filter="type">
                    ${c.type}
                    <button class="badge-remove" aria-label="Remove type filter">\xD7</button>
                </span>
            `),M.innerHTML=e.join(""),M.querySelectorAll(".badge-remove").forEach(r=>{r.addEventListener("click",a=>{let s=a.target.parentElement.dataset.filter;s==="search"?(c.search="",g&&(g.value="")):s==="category"?(c.category="All Categories",b&&(b.value="All Categories")):s==="type"&&(c.type="All Types",f&&(f.value="All Types")),U()})})},se=e=>{let r=N(e),a=O(e),s=B(e),o=e.category||a,i=e?.overproof?.url||(e?.overproof?.slug?`/briefs/${e.overproof.slug}/`:""),h=D(i),S=!!h,y=[];o&&y.push(o),e.date&&y.push(fe(e.date)),S&&y.push("Case file available");let I=y.join(" \u2022 ");return`
            <a class="proof-row"
               href="${r}"
               data-category="${s}"
               data-proof-id="${e.case_id||e.slug}"
               ${S?`data-case-url="${h}"`:""}>
                <div class="proof-row__id">${e.case_id??""}</div>
                <div class="proof-row__content">
                    <h3 class="proof-row__title">${e.title}</h3>
                    <p class="proof-row__meta">${I}</p>
                </div>
                <span class="proof-row__badge ${s?`${s}-violation`:""}">${o||"Other"}</span>
                <svg class="proof-row__action" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                    <path d="M7 5l5 5-5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </a>`},Q=e=>{if(!w)return;if(w.className="proof-list__body timeline-view",w.innerHTML="",!e||e.length===0){w.innerHTML='<p style="text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>';return}let r={};e.forEach(s=>{let o=new Date(s.date),i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;r[i]||(r[i]=[]),r[i].push(s)}),Object.keys(r).sort().reverse().forEach(s=>{let[o,i]=s.split("-"),S=`
                <div class="timeline-month">
                    <h3 class="timeline-month-header">${new Date(o,i-1).toLocaleDateString("en",{month:"long",year:"numeric"})}</h3>
                    <div class="timeline-entries">
                        ${r[s].map(y=>`
                            <div class="timeline-entry">
                                <div class="timeline-date">${new Date(y.date).getDate()}</div>
                                <div class="timeline-content">
                                    <span class="timeline-category">${y.category}</span>
                                    <h4><a href="${N(y)}">${y.title}</a></h4>
                                    <p>${y.thesis}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;w.appendChild(ie(S))})},Z=(e,r=!1)=>{if(!w)return;if(r||(w.className="proof-list__body",w.innerHTML="",l=0),!e||e.length===0){w.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>',k.style.display="none";return}let a=l,s=Math.min(a+v,e.length);e.slice(a,s).forEach(i=>{let h=se(i),S=ie(h);if(!S)return;w.appendChild(S);let y=S.querySelectorAll("img[data-src], source[data-srcset]");y.length!==0&&(u?y.forEach(I=>u.observe(I)):y.forEach(I=>{let L=I.getAttribute("data-srcset"),W=I.getAttribute("data-src");L&&(I.setAttribute("srcset",L),I.removeAttribute("data-srcset")),W&&(I.setAttribute("src",W),I.removeAttribute("data-src"))}))}),l=s,l<e.length?(k.style.display="block",w.parentElement.contains(k)||w.parentElement.appendChild(k)):k.style.display="none"},C=(e,r=!1)=>{d==="timeline"?Q(e):Z(e,r)},R=()=>{if(!T)return;let e=t.length,r=n.length;T.textContent=r===e?`Showing all ${e} proofs`:`Showing ${r} of ${e} proofs`},H=ce(e=>{!e||!e.query||typeof fetch=="function"&&fetch("/.netlify/functions/log-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(r=>{console.error("Failed to send search analytics payload",r)})},500),_=(e,r,a={})=>{if(!e)return;let s=String(e).trim(),o=Number.isFinite(Number(r))?Number(r):0,i=Date.now();E.query===s&&E.results===o&&i-x<6e4||(E={query:s,results:o},x=i,H({query:s,results:o,...a}))},U=async(e=!1)=>{let r=++$;c.search=g?g.value:"",c.category=b?b.value:"All Categories",c.type=f?f.value:"All Types";let a=c.search?c.search.trim():"",s=null;if(a&&(s=await K(a)),r!==$)return;let o=a.toLowerCase();n=t.filter(i=>{if(c.category!=="All Categories"&&i.category!==c.category||c.type!=="All Types"&&O(i)!==c.type)return!1;if(a){if(s){let h=ae(i);if(!h||!s.urls?.has(h))return!1}else if(![i.title,i.thesis,i.stakes,i.violation,i.rule_summary,i.case_id,i.category].join(" ").toLowerCase().includes(o))return!1}return!0}),C(n),R(),z(),e&&a&&_(a,n.length,{filters:{category:c.category,type:c.type},pagefindResults:s?.count??null,strategy:s?"pagefind":"local",triggeredAt:new Date().toISOString()})},oe=ce(async()=>{T&&g&&g.value.trim()&&(T.innerHTML='<span class="loading-indicator"><span class="loading-indicator__label">Searching</span><span class="loading-dots" aria-hidden="true"><span></span><span></span><span></span></span></span>'),await U(!0)},300),X=()=>{if(b){let e=["All Categories",...new Set(t.map(r=>r.category).filter(Boolean))];b.innerHTML="",e.forEach(r=>{let a=document.createElement("option");a.value=r,a.textContent=r,b.appendChild(a)})}if(f){let e=["All Types",...new Set(t.map(r=>O(r)))];f.innerHTML="",e.forEach(r=>{let a=document.createElement("option");a.value=r,a.textContent=r,f.appendChild(a)})}};(()=>{try{u=P();let e=document.getElementById("proof-data");if(!w||!e)return;let r=(e.textContent||"").trim();if(!r)throw new Error("Proof data element is empty.");let a;try{a=JSON.parse(r)}catch{throw new Error("Proof data JSON is invalid.")}let s;if(Array.isArray(a?.proofs))s=a.proofs;else if(Array.isArray(a))s=a;else throw new Error("Unrecognized proof data format.");t=s.filter(o=>o&&o.title),n=[...t],X(),C(n),R(),z(),G(),g&&g.addEventListener("input",oe),b&&b.addEventListener("change",U),f&&f.addEventListener("change",U),p&&p.addEventListener("click",()=>{d=d==="grid"?"timeline":"grid",p.textContent=d==="grid"?"Timeline View":"Grid View",C(n)}),k.addEventListener("click",()=>{C(n,!0)}),A&&A.addEventListener("click",()=>{c={search:"",category:"All Categories",type:"All Types"},g&&(g.value=""),b&&(b.value="All Categories"),f&&(f.value="All Types"),U()})}catch(e){console.error("Error initializing archive:",e),w&&(w.innerHTML='<p style="grid-column:1/-1; text-align:center; padding:40px; color:red;">Could not load proofs. Please try again later.</p>')}})()}ue();document.addEventListener("DOMContentLoaded",()=>{he(),document.querySelector("[data-form-id]")&&Promise.resolve().then(()=>(me(),pe)).then(t=>t.initReviewForm()).catch(t=>console.error("Failed to load review form module",t)),(document.getElementById("share-btn-native")||document.getElementById("print-btn")||document.querySelector("form#secure-contact"))&&Promise.resolve().then(()=>(ye(),ge)).then(t=>t.initShare()).catch(t=>console.error("Failed to load share module",t)),document.querySelector("[data-feedback-form]")&&Promise.resolve().then(()=>(we(),be)).then(t=>t.initFeedback()).catch(t=>console.error("Failed to load feedback module",t)),document.querySelector(".modal")&&Promise.resolve().then(()=>(xe(),Le)).then(t=>t.initModals()).catch(t=>console.error("Failed to load modals module",t))});"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(t=>{console.error("Service worker registration failed:",t)});})();

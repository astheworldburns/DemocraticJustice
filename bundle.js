(()=>{var De=Object.defineProperty;var ae=(e,r)=>()=>(e&&(r=e(e=0)),r);var se=(e,r)=>{for(var u in r)De(e,u,{get:r[u],enumerable:!0})};var Se={};se(Se,{initReviewForm:()=>Be});function Be(){let e=document.querySelector('[data-form-id="challenge-review"]');if(!e)return;let r=Array.from(e.querySelectorAll("[data-form-step]"));if(!r.length)return;let u=Array.from(e.querySelectorAll("[data-progress-step]")),l=e.querySelector("[data-progress-status]"),A=e.querySelector("[data-form-next]"),d=e.querySelector("[data-form-prev]"),p=e.querySelector("[data-form-submit]"),S=e.querySelector("#registration-explanation textarea"),x=e.querySelectorAll('input[name="wv-registered"]'),I=e.querySelectorAll('input[name="prior-remedy"]'),_=e.querySelectorAll("[data-prior-remedy]"),y=e.querySelector("#decision-date"),m=e.querySelector("[data-date-warning]"),T=e.querySelector("[data-deadline-notes]"),g=T?.querySelector("textarea"),E=Array.from(e.querySelectorAll("input, select, textarea"));E.forEach(a=>{if(a.hasAttribute("required")&&(a.dataset.originalRequired="true"),!("originalTabIndex"in a.dataset)){let c=a.getAttribute("tabindex");c!==null?a.dataset.originalTabIndex=c:a.dataset.originalTabIndex=""}});let L=0,N="reviewFormState",F=(()=>{if(typeof window>"u")return{type:"none",getItem:()=>null,setItem:()=>{},removeItem:()=>{}};try{let{sessionStorage:o}=window;if(o){let h=`${N}__test`;return o.setItem(h,"1"),o.removeItem(h),{type:"session",getItem:f=>o.getItem(f),setItem:(f,b)=>o.setItem(f,b),removeItem:f=>o.removeItem(f)}}}catch(o){console.warn("Session storage is unavailable; attempting alternative persistence.",o)}if(typeof window.history<"u"&&typeof window.history.replaceState=="function")return{type:"history",getItem:o=>{let h=window.history.state;if(!h||typeof h!="object")return null;let f=h[o];return typeof f=="string"?f:null},setItem:(o,h)=>{try{let f=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};f[o]=h,window.history.replaceState(f,document.title)}catch(f){console.warn("Failed to persist form state with the History API.",f)}},removeItem:o=>{try{let h=window.history.state&&typeof window.history.state=="object"?{...window.history.state}:{};o in h&&(delete h[o],window.history.replaceState(h,document.title))}catch(h){console.warn("Failed to clear form state from the History API.",h)}}};let c={};return console.warn("Falling back to in-memory form persistence; progress will be lost if the page reloads."),{type:"memory",getItem:o=>Object.prototype.hasOwnProperty.call(c,o)?c[o]:null,setItem:(o,h)=>{c[o]=h},removeItem:o=>{delete c[o]}}})(),q=F.type!=="none",H=F.type==="memory",G="You have unsaved changes. Leave anyway?",P=!1,W=!1,te=a=>{if(P)return a.preventDefault(),a.returnValue=G,G},J=()=>{!H||typeof window>"u"||(P&&!W?(window.addEventListener("beforeunload",te),W=!0):!P&&W&&(window.removeEventListener("beforeunload",te),W=!1))},$=null,ce=a=>typeof RadioNodeList<"u"&&a instanceof RadioNodeList,re=a=>{let c=Object.values(a||{});return L>0||c.some(o=>Array.isArray(o)?o.some(h=>String(h??"").trim()!==""):String(o??"").trim()!=="")},Y=()=>{if(q)try{let a=new FormData(e),c={};a.forEach((f,b)=>{if(b)if(Object.prototype.hasOwnProperty.call(c,b)){let M=c[b];c[b]=Array.isArray(M)?[...M,f]:[M,f]}else c[b]=f});let h=JSON.stringify({currentStep:L,data:c});F.setItem(N,h),P=re(c),J()}catch(a){console.warn("Failed to save form state:",a),P=!1,J()}},B=()=>{q&&(typeof window<"u"?(window.clearTimeout($),$=window.setTimeout(()=>{Y(),$=null},200)):Y())},z=()=>{if(q){try{F.removeItem(N)}catch(a){console.warn("Failed to clear saved form state:",a)}typeof window<"u"&&$!==null&&(window.clearTimeout($),$=null),P=!1,J()}},le=()=>{if(!q)return!1;let a="";try{a=F.getItem(N)||""}catch(b){return console.warn("Failed to read saved form state:",b),!1}if(!a)return!1;let c;try{c=JSON.parse(a)}catch(b){return console.warn("Corrupt saved form state detected; clearing.",b),z(),!1}if(!c||typeof c!="object")return!1;let{currentStep:o=0,data:h={}}=c;Object.entries(h).forEach(([b,M])=>{if(!b)return;let t=e.elements[b];if(!t)return;let n=Array.isArray(M)?M:[M];if(ce(t)){Array.from(t).forEach(s=>{s.checked=n.includes(s.value)});return}let i=s=>{if(s){if(s.type==="checkbox"){s.checked=n.includes(s.value)||!s.value&&n.includes("on");return}if(s.type==="radio"){s.checked=n.includes(s.value);return}if(s.type==="select-multiple"){Array.from(s.options).forEach(v=>{v.selected=n.includes(v.value)});return}typeof s.value=="string"&&(s.value=n[n.length-1]??"")}};typeof t.length=="number"&&!t.tagName?Array.from(t).forEach(i):i(t)});let f=Number.isInteger(o)?Math.min(Math.max(o,0),r.length-1):0;return O(f,{focusField:!1}),P=re(h),J(),!0},Z=()=>{r.forEach((a,c)=>{let o=c===L;a.hidden=!o,a.classList.toggle("is-active",o),a.setAttribute("aria-hidden",o?"false":"true"),a.querySelectorAll("input, select, textarea").forEach(f=>{if(f.type!=="hidden")if(f.dataset.originalRequired==="true"&&(f.required=o),o){let b=f.dataset.originalTabIndex??"";b?f.setAttribute("tabindex",b):f.removeAttribute("tabindex")}else f.setAttribute("tabindex","-1")})}),u.forEach((a,c)=>{let o=c===L;a.classList.toggle("is-active",o),a.classList.toggle("is-complete",c<L),a.setAttribute("aria-current",o?"step":"false")}),l&&(l.textContent=`Step ${L+1} of ${r.length}`),d&&(d.disabled=L===0),A&&(A.hidden=L===r.length-1),p&&(p.hidden=L!==r.length-1)},ne=()=>{let a=r[L];if(!a)return;let c=a.querySelector('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])');c&&c.focus({preventScroll:!1})},O=(a,{focusField:c=!0}={})=>{let o=Math.min(Math.max(a,0),r.length-1);if(o===L){Z(),c&&window.requestAnimationFrame(ne);return}L=o,Z(),c&&window.requestAnimationFrame(ne)},U=()=>{if(!S)return;let c=e.querySelector('input[name="wv-registered"]:checked')?.value==="no";S.required=!!c},j=()=>{let a=e.querySelector('input[name="prior-remedy"]:checked')?.value;_.forEach(c=>{let o=a&&c.dataset.priorRemedy===a;c.hidden=!o;let h=c.querySelector("textarea");h&&(h.required=o&&a==="yes")})},K=()=>{if(!y)return;let a=y.value;if(!a){m&&(m.hidden=!0,m.textContent=""),T&&(T.hidden=!0),g&&(g.required=!1);return}let c=new Date(`${a}T00:00:00`);if(Number.isNaN(c.getTime()))return;let o=new Date,f=new Date(o.getFullYear(),o.getMonth(),o.getDate()).getTime()-c.getTime(),b=Math.floor(f/864e5),M="",t=!1,n=!1;if(b>30)M=`This date is ${b} days old. WVSDEC filings must arrive within 30 days, so explain why the deadline still applies.`,t=!0,n=!0;else if(b<0){let i=Math.abs(b);M=`This date is ${i} day${i===1?"":"s"} in the future. Share upcoming deadlines or hearing dates so we can plan accordingly.`,t=!0}m&&(M?(m.textContent=M,m.hidden=!1):(m.hidden=!0,m.textContent="")),T&&(T.hidden=!t),g&&(g.required=n)},de=()=>{E.forEach(a=>{a.dataset.originalRequired==="true"&&(a.required=!0);let c=a.dataset.originalTabIndex??"";c?a.setAttribute("tabindex",c):a.removeAttribute("tabindex")})},Q=()=>{let a=e.querySelector("#form-error-live");return a||(a=document.createElement("div"),a.id="form-error-live",a.setAttribute("role","alert"),a.setAttribute("aria-live","assertive"),a.className="visually-hidden",e.appendChild(a)),a};A?.addEventListener("click",()=>{U(),j(),K(),e.reportValidity()&&(O(L+1),Y())}),d?.addEventListener("click",()=>{O(L-1),Y()}),x.forEach(a=>{a.addEventListener("change",()=>{U(),B()})}),I.forEach(a=>{a.addEventListener("change",()=>{j(),B()})}),y?.addEventListener("input",()=>{K(),B()}),y?.addEventListener("change",()=>{K(),B()}),e.addEventListener("submit",a=>{if(B(),j(),K(),U(),de(),!e.checkValidity()){a.preventDefault();let c=e.querySelector(":invalid");if(c){let o=c.validationMessage,h=Q();h.textContent=o?`Error: ${o}`:"There is an error in the form.";let f=r.findIndex(b=>b.contains(c));f!==-1&&O(f,{focusField:!1}),window.requestAnimationFrame(()=>{c.reportValidity(),c.focus({preventScroll:!1})})}}},!0),e.addEventListener("reset",()=>{z(),window.requestAnimationFrame(()=>{O(0,{focusField:!1}),U(),j(),K()})}),e.addEventListener("enhanced:success",()=>{z(),e.reset(),O(0,{focusField:!1}),U(),j(),K()}),e.addEventListener("input",B),e.addEventListener("change",B);let X=()=>{U(),j(),K()};X(),le()?X():O(0,{focusField:!1})}var Ee=ae(()=>{});var Ae={};se(Ae,{initShare:()=>Pe});function Pe(){let e=(p=20)=>{let S=window.matchMedia("(prefers-reduced-motion: reduce)").matches;navigator.vibrate&&!S&&navigator.vibrate(p)},r=document.getElementById("share-btn-native");r?.addEventListener("click",async p=>{p.preventDefault();let S={title:r.dataset.shareTitle,text:r.dataset.shareText,url:r.dataset.shareUrl};if(e(),navigator.share)try{await navigator.share(S)}catch{}else{let x=encodeURIComponent(S.url),I=encodeURIComponent(S.title);window.open(`https://twitter.com/intent/tweet?url=${x}&text=${I}`,"_blank")}}),document.getElementById("print-btn")?.addEventListener("click",p=>{p.preventDefault(),e(),window.print()}),document.getElementById("request-review-btn")?.addEventListener("click",()=>e());let A=document.querySelectorAll("form#secure-contact"),d=document.getElementById("cta-error");A.forEach(p=>{p.addEventListener("submit",async S=>{S.preventDefault();let x=new URLSearchParams(new FormData(p)).toString();try{let I=await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x});if(I.ok){e([20,50,20]),d?.style?.setProperty("display","none"),p.dispatchEvent(new CustomEvent("enhanced:success",{detail:{response:I}}));let _=p.dataset.successTarget,y=p.dataset.successMessage;if(_){let m=document.querySelector(_);if(m){p.setAttribute("hidden","true"),m.hidden=!1,m.focus?.();return}}y?p.innerHTML=`<p>${y}</p>`:p.innerHTML="<p>Thanks\u2014we'll be in touch soon.</p>"}else d?.style?.setProperty("display","block"),p.dispatchEvent(new CustomEvent("enhanced:error",{detail:{response:I}}))}catch(I){d?.style?.setProperty("display","block"),p.dispatchEvent(new CustomEvent("enhanced:error",{detail:{error:I}}))}})})}var Le=ae(()=>{});var xe={};se(xe,{initFeedback:()=>_e});function _e(){let e=document.querySelectorAll("[data-feedback-form]");e.length&&e.forEach(r=>{let u=r.querySelector("[data-feedback-value]"),l=Array.from(r.querySelectorAll("[data-feedback-answer]"));if(!u||!l.length)return;let A=r.querySelector("[data-feedback-followup]"),d=r.querySelector("[data-feedback-textarea]"),p=r.querySelector("[data-feedback-submit]"),S=r.querySelector("[data-feedback-status]"),x=!1,I=()=>ee(S,"",null),_=g=>{l.forEach(E=>{let L=E===g;E.classList.toggle("is-selected",L),E.setAttribute("aria-pressed",L?"true":"false")})},y=()=>{A&&(A.hidden=!1),oe(p,!1),d?.focus({preventScroll:!1})},m=({clear:g=!0}={})=>{A&&(A.hidden=!0),g&&d&&(d.value="")},T=async()=>{if(x)return;let g=u.value;if(!g){ee(S,"Choose Yes or No to send feedback.","is-error");return}let E=new FormData(r);E.set("feedback_rating",g),d&&E.set("feedback_details",d.value.trim()),E.set("page_title",document.title),E.set("page_url",window.location.href);let L=[window.location.pathname,window.location.search,window.location.hash].filter(Boolean);E.set("page_path",L.join("")),E.set("page_language",document.documentElement?.lang||""),E.set("referrer",document.referrer||""),E.set("user_agent",navigator.userAgent),E.set("submitted_at",new Date().toISOString());let N=Re(E),D=r.getAttribute("action"),F=D&&D.trim()?D:r.action||window.location.pathname;try{x=!0,Te(l,!0),oe(p,!0),ee(S,"Sending feedback\u2026","is-pending");let q=await fetch(F,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:N});if(!q.ok)throw new Error(`Request failed with status ${q.status}`);ee(S,"Thanks for helping us improve this page.","is-success"),r.dataset.feedbackState="submitted",m()}catch(q){console.error("Feedback submission failed:",q),ee(S,"Sorry\u2014your feedback could not be sent. Please try again.","is-error"),Te(l,!1),oe(p,!1)}finally{x=!1}};l.forEach(g=>{g.addEventListener("click",()=>{if(x)return;let E=g.dataset.feedbackAnswer;E&&(u.value=E,_(g),I(),E==="no"?y():(m(),T()))})}),r.addEventListener("submit",g=>{g.preventDefault(),!x&&(I(),T())})})}var Re,ee,oe,Te,Fe=ae(()=>{Re=e=>{let r=new URLSearchParams;for(let[u,l]of e.entries())typeof l=="string"&&r.append(u,l);return r.toString()},ee=(e,r,u)=>{e&&(e.textContent=r||"",e.classList.remove("is-success","is-error","is-pending"),u&&e.classList.add(u))},oe=(e,r)=>{e&&(e.disabled=r,r?e.setAttribute("aria-disabled","true"):e.removeAttribute("aria-disabled"))},Te=(e,r)=>{e.forEach(u=>oe(u,r))}});var Ce={};se(Ce,{closeModal:()=>ie,initModals:()=>Ue});function Ue(){let e=document.querySelectorAll(".modal");e.length&&(Oe(),e.forEach(r=>{let u=he(r);r.querySelector(".modal-close")?.addEventListener("click",()=>ie(r)),r.addEventListener("click",A=>{A.target===r&&ie(r)}),r.classList.contains("active")&&!r.hasAttribute("hidden")&&u.activate()}))}var fe,Ie,ke,qe,he,Ne,He,ie,Oe,Me=ae(()=>{fe=class{constructor(r){this.element=r,this.focusableElements=null,this.firstFocusable=null,this.lastFocusable=null,this.active=!1,this.boundKeyHandler=null,this.previouslyFocusedElement=null}activate(){if(this.active)return;let r=document.activeElement;r&&typeof r.focus=="function"?this.previouslyFocusedElement=r:this.previouslyFocusedElement=null,this.focusableElements=this.element.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select, [tabindex]:not([tabindex="-1"])'),this.firstFocusable=this.focusableElements[0]||null,this.lastFocusable=this.focusableElements[this.focusableElements.length-1]||null,this.boundKeyHandler||(this.boundKeyHandler=this.handleKeyDown.bind(this)),this.element.addEventListener("keydown",this.boundKeyHandler),this.firstFocusable?.focus(),this.active=!0}deactivate(){if(!this.active)return;this.boundKeyHandler&&this.element.removeEventListener("keydown",this.boundKeyHandler);let r=this.element,u=()=>{let d=document.querySelector(".nav-links a");if(d&&typeof d.focus=="function"){d.focus();return}let p=document.querySelector("a[href], button:not([disabled])");p&&typeof p.focus=="function"&&p.focus()},l=d=>{if(!d||typeof d.focus!="function"||!(typeof d.isConnected=="boolean"?d.isConnected:document.body.contains(d)))return!1;let S=d.hasAttribute("aria-hidden")||d.getAttribute("hidden")!==null,x="disabled"in d&&d.disabled,I=typeof d.getClientRects=="function"?d.getClientRects().length>0:d.offsetParent!==null;return!S&&!x&&I},A=r?.dataset?.openerId;if(A){let d=document.getElementById(A);l(d)?d.focus():l(this.previouslyFocusedElement)?this.previouslyFocusedElement.focus():u()}else l(this.previouslyFocusedElement)?this.previouslyFocusedElement.focus():u();r?.dataset&&delete r.dataset.openerId,this.previouslyFocusedElement=null,this.active=!1}handleKeyDown(r){if(r.key==="Tab"&&(r.shiftKey?document.activeElement===this.firstFocusable&&(r.preventDefault(),this.lastFocusable?.focus()):document.activeElement===this.lastFocusable&&(r.preventDefault(),this.firstFocusable?.focus())),r.key==="Escape"){let u=this.element.closest(".modal");u&&ie(u)}}},Ie=new WeakMap,ke=0,qe=!1,he=e=>{let r=Ie.get(e);return r||(r=new fe(e),Ie.set(e,r)),r},Ne=e=>(e.id||(ke+=1,e.id=`modal-trigger-${ke}`),e.id),He=(e,r)=>{if(r){let l=Ne(r);e.dataset.openerId=l}e.removeAttribute("hidden"),e.classList.add("active"),document.body.classList.add("body--modal-open"),he(e).activate(),e.setAttribute("aria-modal","true"),e.setAttribute("role","dialog")},ie=e=>{he(e).deactivate(),e.classList.remove("active"),e.setAttribute("hidden",""),document.body.classList.remove("body--modal-open")},Oe=()=>{qe||(qe=!0,document.addEventListener("click",e=>{let r=e.target.closest("[data-modal-target]");if(!r)return;let u=r.dataset.modalTarget;if(!u)return;let l=document.getElementById(u);l&&(e.preventDefault(),He(l,r))}))}});var ye=()=>{let e;try{e=localStorage.getItem("theme")}catch{e=null}let r=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,u=e||(r?"dark":"light");document.documentElement.setAttribute("data-theme",u),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{let A;try{A=localStorage.getItem("theme")}catch{A=null}A||document.documentElement.setAttribute("data-theme",l.matches?"dark":"light")})};var ue=e=>{let r=document.createElement("template");return r.innerHTML=e.trim(),r.content.firstChild},ve=e=>{let r=new Date(e);return isNaN(r.getTime())?"":r.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},we=(e,r)=>{let u;return function(...A){let d=()=>{clearTimeout(u),e(...A)};clearTimeout(u),u=setTimeout(d,r)}};var $e=e=>String(e??"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase();function be(){let e=[],r=[],u="grid",l={search:"",category:"All Categories",type:"All Types"},A=12,d=0,p,S=null,x={query:"",results:null},I=0,_=0,y=document.getElementById("case-grid"),m=document.getElementById("search-input"),T=document.getElementById("category-filter"),g=document.getElementById("type-filter"),E=document.getElementById("view-toggle"),L=document.getElementById("filter-badges"),N=document.getElementById("reset-filters"),D=document.getElementById("results-count"),F=document.createElement("button"),q=document.querySelector(".nav"),H=document.querySelector(".nav-toggle"),G=document.getElementById("primary-nav");D&&(D.setAttribute("role","status"),D.setAttribute("aria-live","polite")),F.className="btn btn-outline-blue",F.textContent="Load More",F.style.display="none",F.style.margin="32px auto",q&&H&&G&&(H.addEventListener("click",()=>{let t=H.getAttribute("aria-expanded")==="true";H.setAttribute("aria-expanded",String(!t)),q.classList.toggle("nav--open",!t),t?H.focus():(G.querySelector('[aria-current="page"], .is-active')||G.querySelector("a"))?.focus()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&q.classList.contains("nav--open")&&(H.setAttribute("aria-expanded","false"),q.classList.remove("nav--open"),H.focus())}));let P=!1,W=()=>typeof document<"u"&&typeof document.startViewTransition=="function",te=t=>{if(!t)return;let n=()=>{window.location.href=t};if(!W()){n();return}try{document.startViewTransition(n)}catch(i){console.warn("View transition navigation failed, falling back to hard navigation.",i),n()}},J=()=>{!y||P||(P=!0,y.addEventListener("click",t=>{if(t.defaultPrevented||t.button!==0||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)return;let n=t.target.closest("a");if(!n||!y.contains(n)||n.hasAttribute("download")||n.target&&n.target!=="_self")return;let i;try{i=new URL(n.getAttribute("href")||"",window.location.href)}catch{return}i.origin===window.location.origin&&(t.preventDefault(),te(i.toString()))}))};if(m){let t=()=>{requestAnimationFrame(()=>{if(m)try{m.focus({preventScroll:!0})}catch{m.focus()}})};(()=>{if(window.location.hash==="#search-input")return!0;try{return new URLSearchParams(window.location.search).get("focus")==="search"}catch{return!1}})()&&t(),window.addEventListener("hashchange",()=>{window.location.hash==="#search-input"&&t()})}let $=t=>t.category?.includes("Finance")||t.category?.includes("Campaign")?"Financial Violation":t.category?.includes("MOU")||t.category?.includes("DNC")?"Procedural Violation":t.category?.includes("Bylaw")||t.category?.includes("Charter")?"Governance Failure":"Other",ce=t=>{let n=$(t).toLowerCase();return n.includes("financial")?"financial":n.includes("procedural")?"procedural":n.includes("governance")?"governance":"other"},re=t=>$e(t),Y=(t={})=>t.slug?t.slug:t.case_id?re(t.case_id):"",B=(t={})=>{let n=t?.overproof?.slug,i=Y(t);return!n||!i?(console.warn("Missing slug data for proof URL",{caseId:t?.case_id,proofSlug:i,overproofSlug:n}),"#"):`/proofs/${n}/${i}/`},z=(t="")=>{if(!t)return"";try{let n=typeof window<"u"&&window.location?window.location.origin:"https://democraticjustice.org",s=new URL(t,n).pathname||"";return s=s.replace(/index\.html$/i,""),s.endsWith("/")||(s=`${s}/`),s.replace(/\/+$/,"/")}catch(n){return console.warn("Failed to normalize URL for search matching",{url:t,error:n}),t}},le=(t={})=>z(B(t)),Z=()=>S||(typeof window.pagefindInit!="function"?(S=Promise.resolve(null),S):(S=window.pagefindInit({baseUrl:"/pagefind/"}).catch(t=>(console.error("Failed to initialize Pagefind search index:",t),null)),S)),ne=async t=>{if(!t)return null;let n=await Z();if(!n||typeof n.search!="function")return null;try{let i=await n.search(t),s=Array.isArray(i?.results)?i.results:[],v=new Set;return s.length&&(await Promise.allSettled(s.map(k=>typeof k?.data=="function"?k.data():Promise.resolve(null)))).forEach(k=>{k.status==="fulfilled"&&k.value&&k.value.url&&v.add(z(k.value.url))}),{urls:v,count:s.length}}catch(i){return console.error("Pagefind search failed:",i),null}},O=()=>typeof IntersectionObserver!="function"?null:new IntersectionObserver((t,n)=>{t.forEach(i=>{if(!i.isIntersecting)return;let s=i.target,v=s.getAttribute("data-srcset"),w=s.getAttribute("data-src");v&&(s.setAttribute("srcset",v),s.removeAttribute("data-srcset")),w&&(s.setAttribute("src",w),s.removeAttribute("data-src")),n.unobserve(s)})},{rootMargin:"50px"}),U=()=>{if(!L)return;let t=[];l.search&&t.push(`
                <span class="filter-badge" data-filter="search">
                    Search: "${l.search}"
                    <button class="badge-remove" aria-label="Remove search filter">\xD7</button>
                </span>
            `),l.category!=="All Categories"&&t.push(`
                <span class="filter-badge" data-filter="category">
                    ${l.category}
                    <button class="badge-remove" aria-label="Remove category filter">\xD7</button>
                </span>
            `),l.type!=="All Types"&&t.push(`
                <span class="filter-badge" data-filter="type">
                    ${l.type}
                    <button class="badge-remove" aria-label="Remove type filter">\xD7</button>
                </span>
            `),L.innerHTML=t.join(""),L.querySelectorAll(".badge-remove").forEach(n=>{n.addEventListener("click",i=>{let s=i.target.parentElement.dataset.filter;s==="search"?(l.search="",m&&(m.value="")):s==="category"?(l.category="All Categories",T&&(T.value="All Categories")):s==="type"&&(l.type="All Types",g&&(g.value="All Types")),c()})})},j=t=>{let n=B(t),i=$(t),s=ce(t),v=t.category||i,w=t?.overproof?.url||(t?.overproof?.slug?`/briefs/${t.overproof.slug}/`:""),k=z(w),V=!!k,C=[];v&&C.push(v),t.date&&C.push(ve(t.date)),V&&C.push("Case file available");let R=C.join(" \u2022 ");return`
            <a class="proof-row"
               href="${n}"
               data-category="${s}"
               data-proof-id="${t.case_id||t.slug}"
               ${V?`data-case-url="${k}"`:""}>
                <div class="proof-row__id">${t.case_id??""}</div>
                <div class="proof-row__content">
                    <h3 class="proof-row__title">${t.title}</h3>
                    <p class="proof-row__meta">${R}</p>
                </div>
                <span class="proof-row__badge ${s?`${s}-violation`:""}">${v||"Other"}</span>
                <svg class="proof-row__action" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                    <path d="M7 5l5 5-5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </a>`},K=t=>{if(!y)return;if(y.className="proof-list__body timeline-view",y.innerHTML="",!t||t.length===0){y.innerHTML='<p style="text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>';return}let n={};t.forEach(s=>{let v=new Date(s.date),w=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}`;n[w]||(n[w]=[]),n[w].push(s)}),Object.keys(n).sort().reverse().forEach(s=>{let[v,w]=s.split("-"),V=`
                <div class="timeline-month">
                    <h3 class="timeline-month-header">${new Date(v,w-1).toLocaleDateString("en",{month:"long",year:"numeric"})}</h3>
                    <div class="timeline-entries">
                        ${n[s].map(C=>`
                            <div class="timeline-entry">
                                <div class="timeline-date">${new Date(C.date).getDate()}</div>
                                <div class="timeline-content">
                                    <span class="timeline-category">${C.category}</span>
                                    <h4><a href="${B(C)}">${C.title}</a></h4>
                                    <p>${C.thesis}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;y.appendChild(ue(V))})},de=(t,n=!1)=>{if(!y)return;if(n||(y.className="proof-list__body",y.innerHTML="",d=0),!t||t.length===0){y.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>',F.style.display="none";return}let i=d,s=Math.min(i+A,t.length);t.slice(i,s).forEach(w=>{let k=j(w),V=ue(k);if(!V)return;y.appendChild(V);let C=V.querySelectorAll("img[data-src], source[data-srcset]");C.length!==0&&(p?C.forEach(R=>p.observe(R)):C.forEach(R=>{let me=R.getAttribute("data-srcset"),ge=R.getAttribute("data-src");me&&(R.setAttribute("srcset",me),R.removeAttribute("data-srcset")),ge&&(R.setAttribute("src",ge),R.removeAttribute("data-src"))}))}),d=s,d<t.length?(F.style.display="block",y.parentElement.contains(F)||y.parentElement.appendChild(F)):F.style.display="none"},Q=(t,n=!1)=>{u==="timeline"?K(t):de(t,n)},X=()=>{if(!D)return;let t=e.length,n=r.length;D.textContent=n===t?`Showing all ${t} proofs`:`Showing ${n} of ${t} proofs`},pe=we(t=>{!t||!t.query||typeof fetch=="function"&&fetch("/.netlify/functions/log-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(n=>{console.error("Failed to send search analytics payload",n)})},500),a=(t,n,i={})=>{if(!t)return;let s=String(t).trim(),v=Number.isFinite(Number(n))?Number(n):0,w=Date.now();x.query===s&&x.results===v&&w-I<6e4||(x={query:s,results:v},I=w,pe({query:s,results:v,...i}))},c=async(t=!1)=>{let n=++_;l.search=m?m.value:"",l.category=T?T.value:"All Categories",l.type=g?g.value:"All Types";let i=l.search?l.search.trim():"",s=null;if(i&&(s=await ne(i)),n!==_)return;let v=i.toLowerCase();r=e.filter(w=>{if(l.category!=="All Categories"&&w.category!==l.category||l.type!=="All Types"&&$(w)!==l.type)return!1;if(i){if(s){let k=le(w);if(!k||!s.urls?.has(k))return!1}else if(![w.title,w.thesis,w.stakes,w.violation,w.rule_summary,w.case_id,w.category].join(" ").toLowerCase().includes(v))return!1}return!0}),Q(r),X(),U(),t&&i&&a(i,r.length,{filters:{category:l.category,type:l.type},pagefindResults:s?.count??null,strategy:s?"pagefind":"local",triggeredAt:new Date().toISOString()})},o=null,h=async()=>{o=null,D&&m&&m.value.trim()&&(D.innerHTML='<span class="loading-indicator"><span class="loading-indicator__label">Searching</span><span class="loading-dots" aria-hidden="true"><span></span><span></span><span></span></span></span>'),await c(!0)},f=()=>{o!==null&&typeof cancelAnimationFrame=="function"&&(cancelAnimationFrame(o),o=null),typeof requestAnimationFrame=="function"?o=requestAnimationFrame(()=>{h()}):h()},b=()=>{if(T){let t=["All Categories",...new Set(e.map(n=>n.category).filter(Boolean))];T.innerHTML="",t.forEach(n=>{let i=document.createElement("option");i.value=n,i.textContent=n,T.appendChild(i)})}if(g){let t=["All Types",...new Set(e.map(n=>$(n)))];g.innerHTML="",t.forEach(n=>{let i=document.createElement("option");i.value=n,i.textContent=n,g.appendChild(i)})}};(()=>{try{p=O();let t=document.getElementById("proof-data");if(!y||!t)return;J();let n=(t.textContent||"").trim();if(!n)throw new Error("Proof data element is empty.");let i;try{i=JSON.parse(n)}catch{throw new Error("Proof data JSON is invalid.")}let s;if(Array.isArray(i?.proofs))s=i.proofs;else if(Array.isArray(i))s=i;else throw new Error("Unrecognized proof data format.");e=s.filter(v=>v&&v.title),r=[...e],b(),Q(r),X(),U(),Z(),m&&m.addEventListener("input",f),T&&T.addEventListener("change",c),g&&g.addEventListener("change",c),E&&E.addEventListener("click",()=>{u=u==="grid"?"timeline":"grid",E.textContent=u==="grid"?"Timeline View":"Grid View",Q(r)}),F.addEventListener("click",()=>{Q(r,!0)}),N&&N.addEventListener("click",()=>{l={search:"",category:"All Categories",type:"All Types"},m&&(m.value=""),T&&(T.value="All Categories"),g&&(g.value="All Types"),c()})}catch(t){console.error("Error initializing archive:",t),y&&(y.innerHTML='<p style="grid-column:1/-1; text-align:center; padding:40px; color:red;">Could not load proofs. Please try again later.</p>')}})()}ye();document.addEventListener("DOMContentLoaded",()=>{be(),document.querySelector("[data-form-id]")&&Promise.resolve().then(()=>(Ee(),Se)).then(e=>e.initReviewForm()).catch(e=>console.error("Failed to load review form module",e)),(document.getElementById("share-btn-native")||document.getElementById("print-btn")||document.querySelector("form#secure-contact"))&&Promise.resolve().then(()=>(Le(),Ae)).then(e=>e.initShare()).catch(e=>console.error("Failed to load share module",e)),document.querySelector("[data-feedback-form]")&&Promise.resolve().then(()=>(Fe(),xe)).then(e=>e.initFeedback()).catch(e=>console.error("Failed to load feedback module",e)),document.querySelector(".modal")&&Promise.resolve().then(()=>(Me(),Ce)).then(e=>e.initModals()).catch(e=>console.error("Failed to load modals module",e))});"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(e=>{console.error("Service worker registration failed:",e)});})();

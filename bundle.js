(()=>{var X=()=>{let r;try{r=localStorage.getItem("theme")}catch{r=null}let o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,w=r||(o?"dark":"light");document.documentElement.setAttribute("data-theme",w),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",c=>{let S;try{S=localStorage.getItem("theme")}catch{S=null}S||document.documentElement.setAttribute("data-theme",c.matches?"dark":"light")})};var W=r=>{let o=document.createElement("template");return o.innerHTML=r.trim(),o.content.firstChild},J=r=>{let o=new Date(r);return isNaN(o.getTime())?"":o.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},Z=(r,o)=>{let w;return function(...S){let E=()=>{clearTimeout(w),r(...S)};clearTimeout(w),w=setTimeout(E,o)}};function ee(){let r=[],o=[],w="grid",c={search:"",category:"All Categories",type:"All Types"},S=12,E=0,u,h=[],m=document.getElementById("case-grid"),p=document.getElementById("search-input"),y=document.getElementById("category-filter"),v=document.getElementById("type-filter"),x=document.getElementById("view-toggle"),T=document.getElementById("filter-badges"),M=document.getElementById("reset-filters"),D=document.getElementById("results-count"),A=document.createElement("button"),g=document.querySelector(".nav"),$=document.querySelector(".nav-toggle"),j=document.getElementById("primary-nav");A.className="btn btn-outline-blue",A.textContent="Load More",A.style.display="none",A.style.margin="32px auto",g&&$&&j&&($.addEventListener("click",()=>{let e=$.getAttribute("aria-expanded")==="true";$.setAttribute("aria-expanded",String(!e)),g.classList.toggle("nav--open",!e),e?$.focus():j.querySelector("a")?.focus()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&g.classList.contains("nav--open")&&($.setAttribute("aria-expanded","false"),g.classList.remove("nav--open"),$.focus())}));let C=e=>e.category?.includes("Finance")||e.category?.includes("Campaign")?"Financial Violation":e.category?.includes("MOU")||e.category?.includes("DNC")?"Procedural Violation":e.category?.includes("Bylaw")||e.category?.includes("Charter")?"Governance Failure":"Other",B=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),q=e=>e?B(e):"",F=e=>e?String(e).split(/[^0-9]+/).filter(Boolean).map(t=>Number.parseInt(t,10)):[],K=(e,t)=>{let n=F(e),a=F(t),i=Math.max(n.length,a.length);for(let d=0;d<i;d+=1){let k=(n[d]??0)-(a[d]??0);if(k!==0)return k}return String(e??"").localeCompare(String(t??""))},s=(e={},t={})=>{let n=K(e?.case_id,t?.case_id);if(n!==0)return n;let a=e?.date?new Date(e.date).getTime():0,i=t?.date?new Date(t.date).getTime():0;return a!==i?a-i:String(e?.title??"").localeCompare(String(t?.title??""))};function l(e){let t=e.querySelector("a")?.href?.split("/proofs/")[1]||"";return e?.dataset?.proofId||t.split("/")[1]||""}function f(e){let t=document.getElementById("compare-btn");if(!t||!e)return;let n=e.querySelector(".compare-checkbox");n&&n.remove();let a=document.createElement("input");a.type="checkbox",a.className="compare-checkbox",a.title="Select for comparison (max 3)",a.addEventListener("change",i=>{let d=l(e);d&&(i.target.checked?h.length<3?h.push(d):(i.target.checked=!1,alert("Maximum 3 proofs can be compared.")):h=h.filter(k=>k!==d),t.textContent=`Compare Selected (${h.length})`,t.disabled=h.length<2)}),e.prepend(a)}function I(){let e=document.getElementById("compare-btn"),t=document.querySelectorAll(".case-card");!e||!t.length||(h=[],e.textContent="Compare Selected (0)",e.disabled=!0,t.forEach(n=>f(n)),e.onclick=()=>{h.length>=2&&R(h)})}function R(e){let t=document.getElementById("comparison-view");if(!t)return;let n=t.querySelector(".comparison-grid");if(!n)return;n.innerHTML=`
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Aspect</th>
                        ${e.map(b=>`<th>Proof ${b.replace("wvdp-","").slice(0,10)}\u2026</th>`).join("")}
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Category</td>${e.map(()=>"<td>Loading\u2026</td>").join("")}</tr>
                    <tr><td>Date</td>${e.map(()=>"<td>Loading\u2026</td>").join("")}</tr>
                    <tr><td>Key Violation</td>${e.map(()=>"<td>Loading\u2026</td>").join("")}</tr>
                </tbody>
            </table>
        `,t.style.display="block";let a=b=>r.find(L=>L.case_id===b||L.slug===b||L.slug&&b.startsWith(L.slug)),i=n.querySelectorAll("tbody tr"),d=i[0].querySelectorAll("td:not(:first-child)"),k=i[1].querySelectorAll("td:not(:first-child)"),N=i[2].querySelectorAll("td:not(:first-child)");e.forEach((b,L)=>{let P=a(b);P&&(d[L].textContent=P.category||"",k[L].textContent=new Date(P.date).toLocaleDateString(),N[L].textContent=P.violation||P.thesis||"")})}let _=()=>new IntersectionObserver((t,n)=>{t.forEach(a=>{if(!a.isIntersecting)return;let i=a.target;if(i.dataset.proofData){let d=null;try{d=JSON.parse(i.dataset.proofData)}catch(k){console.error("Failed to parse proof data for lazy-loaded card:",k,{proofId:i.dataset.proofId})}i.dataset.proofData="",d&&(U(i,d),document.getElementById("compare-btn")&&f(i))}n.unobserve(i)})},{rootMargin:"50px"});class H{constructor(t){this.element=t,this.focusableElements=null,this.firstFocusable=null,this.lastFocusable=null,this.active=!1}activate(){this.active||(this.focusableElements=this.element.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select, [tabindex]:not([tabindex="-1"])'),this.firstFocusable=this.focusableElements[0],this.lastFocusable=this.focusableElements[this.focusableElements.length-1],this.element.addEventListener("keydown",this.handleKeyDown.bind(this)),this.firstFocusable?.focus(),this.active=!0,this.lastFocus=document.activeElement)}deactivate(){this.active&&(this.element.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.lastFocus?.focus(),this.active=!1)}handleKeyDown(t){if(t.key==="Tab"&&(t.shiftKey?document.activeElement===this.firstFocusable&&(t.preventDefault(),this.lastFocusable?.focus()):document.activeElement===this.lastFocusable&&(t.preventDefault(),this.firstFocusable?.focus())),t.key==="Escape"){this.deactivate();let n=this.element.closest(".modal");n&&(n.classList.remove("active"),n.setAttribute("hidden",""),document.body.classList.remove("body--modal-open"))}}}let z=()=>{if(!T)return;let e=[];c.search&&e.push(`
                <span class="filter-badge" data-filter="search">
                    Search: "${c.search}"
                    <button class="badge-remove" aria-label="Remove search filter">\xD7</button>
                </span>
            `),c.category!=="All Categories"&&e.push(`
                <span class="filter-badge" data-filter="category">
                    ${c.category}
                    <button class="badge-remove" aria-label="Remove category filter">\xD7</button>
                </span>
            `),c.type!=="All Types"&&e.push(`
                <span class="filter-badge" data-filter="type">
                    ${c.type}
                    <button class="badge-remove" aria-label="Remove type filter">\xD7</button>
                </span>
            `),T.innerHTML=e.join(""),T.querySelectorAll(".badge-remove").forEach(t=>{t.addEventListener("click",n=>{let a=n.target.parentElement.dataset.filter;a==="search"?(c.search="",p&&(p.value="")):a==="category"?(c.category="All Categories",y&&(y.value="All Categories")):a==="type"&&(c.type="All Types",v&&(v.value="All Types")),V()})})},O=(e,t=!1)=>{let n=`/proofs/${q(e.umbrella_category)}/${e.slug}/`,a=C(e);return t?`
                <article class="case-card case-card-lazy"
                         data-proof-id="${e.case_id||e.slug}">
                    <div class="card-skeleton">
                        <div class="skeleton-line skeleton-title"></div>
                        <div class="skeleton-line skeleton-meta"></div>
                        <div class="skeleton-line skeleton-text"></div>
                        <div class="skeleton-line skeleton-text"></div>
                    </div>
                </article>`:`
            <article class="case-card" data-type="${a}"
                     data-proof-id="${e.case_id||e.slug}">
                <div class="case-card-header">
                    <span class="proof-type-badge ${a.toLowerCase().replace(/\s+/g,"-")}">${a}</span>
                </div>
                <h3><a href="${n}">${e.title}</a></h3>
                <p class="case-meta">
                    ${e.case_id} \u2022 ${J(e.date)}
                    ${e.category?` \u2022 <span style="font-weight: 700;">${e.category}</span>`:""}
                </p>
                <p>${e.thesis}</p>
                <a href="${n}" class="case-link">Examine Proof \u2192</a>
            </article>`},U=(e,t)=>{let n=`/proofs/${q(t.umbrella_category)}/${t.slug}/`,a=C(t);e.dataset.proofId=t.case_id||t.slug,e.innerHTML=`
            <div class="case-card-header">
                <span class="proof-type-badge ${a.toLowerCase().replace(/\s+/g,"-")}">${a}</span>
            </div>
            <h3><a href="${n}">${t.title}</a></h3>
            <p class="case-meta">
                ${t.case_id} \u2022 ${J(t.date)}
                ${t.category?` \u2022 <span style="font-weight: 700;">${t.category}</span>`:""}
            </p>
            <p>${t.thesis}</p>
            <a href="${n}" class="case-link">Examine Proof \u2192</a>`,e.classList.remove("case-card-lazy")},re=e=>{if(!m)return;if(m.className="timeline-view",m.innerHTML="",!e||e.length===0){m.innerHTML='<p style="text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>';return}let t={};e.forEach(a=>{let i=new Date(a.date),d=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;t[d]||(t[d]=[]),t[d].push(a)}),Object.keys(t).sort().reverse().forEach(a=>{let[i,d]=a.split("-"),N=`
                <div class="timeline-month">
                    <h3 class="timeline-month-header">${new Date(i,d-1).toLocaleDateString("en",{month:"long",year:"numeric"})}</h3>
                    <div class="timeline-entries">
                        ${t[a].map(b=>`
                            <div class="timeline-entry">
                                <div class="timeline-date">${new Date(b.date).getDate()}</div>
                                <div class="timeline-content">
                                    <span class="timeline-category">${b.category}</span>
                                    <h4><a href="/proofs/${q(b.umbrella_category)}/${b.slug}/">${b.title}</a></h4>
                                    <p>${b.thesis}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;m.appendChild(W(N))})},ae=(e,t=!1)=>{if(!m)return;if(t||(m.className="case-grid",m.innerHTML="",E=0),!e||e.length===0){m.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">No matching proofs found.</p>',A.style.display="none";return}let n=E,a=Math.min(n+S,e.length);e.slice(n,a).forEach((d,k)=>{let N=k>6,b=O(d,N),L=W(b);if(N&&L)try{L.dataset.proofData=JSON.stringify(d)}catch(P){console.error("Failed to serialize proof for lazy loading:",P,{proofId:d.case_id||d.slug})}m.appendChild(L),N&&u&&u.observe(L)}),E=a,E<e.length?(A.style.display="block",m.parentElement.contains(A)||m.parentElement.appendChild(A)):A.style.display="none"},G=(e,t=!1)=>{w==="timeline"?re(e):ae(e,t),setTimeout(()=>I(),100)},Y=()=>{if(!D)return;let e=r.length,t=o.length;D.textContent=t===e?`Showing all ${e} proofs`:`Showing ${t} of ${e} proofs`},V=()=>{c.search=p?p.value:"",c.category=y?y.value:"All Categories",c.type=v?v.value:"All Types",o=r.filter(e=>{if(c.category!=="All Categories"&&e.category!==c.category||c.type!=="All Types"&&C(e)!==c.type)return!1;if(c.search){let t=c.search.toLowerCase();if(![e.title,e.thesis,e.stakes,e.violation,e.rule_summary,e.case_id,e.category].join(" ").toLowerCase().includes(t))return!1}return!0}),G(o),Y(),z()},se=Z(()=>{V()},300),ie=()=>{if(y){let e=["All Categories",...new Set(r.map(t=>t.category).filter(Boolean))];y.innerHTML="",e.forEach(t=>{let n=document.createElement("option");n.value=t,n.textContent=t,y.appendChild(n)})}if(v){let e=["All Types",...new Set(r.map(t=>C(t)))];v.innerHTML="",e.forEach(t=>{let n=document.createElement("option");n.value=t,n.textContent=t,v.appendChild(n)})}},oe=()=>{let e=document.querySelectorAll(".modal");document.querySelectorAll("[data-modal-target]").forEach(n=>{n.addEventListener("click",()=>{let a=n.dataset.modalTarget,i=document.getElementById(a);i&&ce(i)})}),e.forEach(n=>{let a=n.querySelector(".modal-close"),i=new H(n);a?.addEventListener("click",()=>{Q(n,i)}),n.addEventListener("click",d=>{d.target===n&&Q(n,i)}),n._focusTrap=i})},ce=e=>{e.removeAttribute("hidden"),e.classList.add("active"),document.body.classList.add("body--modal-open"),e._focusTrap&&e._focusTrap.activate(),e.setAttribute("aria-modal","true"),e.setAttribute("role","dialog")},Q=(e,t)=>{e.classList.remove("active"),e.setAttribute("hidden",""),document.body.classList.remove("body--modal-open"),t&&t.deactivate()};(async()=>{try{u=_();let e=await fetch("/data/proofs.json",{cache:"no-store"});if(!e.ok)throw new Error("Failed to load proofs.json");let t=await e.json(),n=Array.isArray(t)?t:Array.isArray(t?.proofs)?t.proofs:Array.isArray(t?.items)?t.items:[];if((!Array.isArray(n)||n.length===0)&&!Array.isArray(t)&&!Array.isArray(t?.proofs)&&!Array.isArray(t?.items))throw new Error("Unrecognized proofs data format.");r=n.filter(a=>a&&a.title).sort(s),o=[...r],ie(),G(o),Y(),p&&p.addEventListener("input",se),y&&y.addEventListener("change",V),v&&v.addEventListener("change",V),x&&x.addEventListener("click",()=>{w=w==="grid"?"timeline":"grid",x.textContent=w==="grid"?"Timeline View":"Grid View",G(o)}),A.addEventListener("click",()=>{G(o,!0)}),M&&M.addEventListener("click",()=>{c={search:"",category:"All Categories",type:"All Types"},p&&(p.value=""),y&&(y.value="All Categories"),v&&(v.value="All Types"),V()}),oe()}catch(e){console.error("Error initializing archive:",e),m&&(m.innerHTML='<p style="grid-column:1/-1; text-align:center; padding:40px; color:red;">Could not load proofs. Please try again later.</p>')}})()}function te(){let r=(u=20)=>{let h=window.matchMedia("(prefers-reduced-motion: reduce)").matches;navigator.vibrate&&!h&&navigator.vibrate(u)},o=document.getElementById("share-btn-native");o?.addEventListener("click",async u=>{u.preventDefault();let h={title:o.dataset.shareTitle,text:o.dataset.shareText,url:o.dataset.shareUrl};if(r(),navigator.share)try{await navigator.share(h)}catch{}else{let m=encodeURIComponent(h.url),p=encodeURIComponent(h.title);window.open(`https://twitter.com/intent/tweet?url=${m}&text=${p}`,"_blank")}}),document.getElementById("print-btn")?.addEventListener("click",u=>{u.preventDefault(),r(),window.print()}),document.getElementById("request-review-btn")?.addEventListener("click",()=>r());let S=document.querySelectorAll("form#secure-contact"),E=document.getElementById("cta-error");S.forEach(u=>{u.addEventListener("submit",async h=>{h.preventDefault();let m=new URLSearchParams(new FormData(u)).toString();try{let p=await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:m});if(p.ok){r([20,50,20]),E?.style?.setProperty("display","none"),u.dispatchEvent(new CustomEvent("enhanced:success",{detail:{response:p}}));let y=u.dataset.successTarget,v=u.dataset.successMessage;if(y){let x=document.querySelector(y);if(x){u.setAttribute("hidden","true"),x.hidden=!1,x.focus?.();return}}v?u.innerHTML=`<p>${v}</p>`:u.innerHTML="<p>Thanks\u2014we'll be in touch soon.</p>"}else E?.style?.setProperty("display","block"),u.dispatchEvent(new CustomEvent("enhanced:error",{detail:{response:p}}))}catch(p){E?.style?.setProperty("display","block"),u.dispatchEvent(new CustomEvent("enhanced:error",{detail:{error:p}}))}})})}function ne(){let r=document.querySelector('[data-form-id="challenge-review"]');if(!r)return;let o=Array.from(r.querySelectorAll("[data-form-step]"));if(!o.length)return;let w=Array.from(r.querySelectorAll("[data-progress-step]")),c=r.querySelector("[data-progress-status]"),S=r.querySelector("[data-form-next]"),E=r.querySelector("[data-form-prev]"),u=r.querySelector("[data-form-submit]"),h=r.querySelector("[data-registration-explanation]"),m=h?.querySelector("textarea"),p=r.querySelectorAll('input[name="wv-registered"]'),y=r.querySelectorAll('input[name="prior-remedy"]'),v=r.querySelectorAll("[data-prior-remedy]"),x=r.querySelector("#decision-date"),T=r.querySelector("[data-date-warning]"),M=r.querySelector("[data-deadline-notes]"),D=M?.querySelector("textarea"),A=Array.from(r.querySelectorAll("input, select, textarea"));A.forEach(s=>{s.hasAttribute("required")&&(s.dataset.originalRequired="true")});let g=0,$=()=>{o.forEach((s,l)=>{let f=l===g;s.hidden=!f,s.classList.toggle("is-active",f),s.setAttribute("aria-hidden",f?"false":"true"),s.querySelectorAll("input, select, textarea").forEach(R=>{R.dataset.originalRequired==="true"&&(R.required=f)})}),w.forEach((s,l)=>{let f=l===g;s.classList.toggle("is-active",f),s.classList.toggle("is-complete",l<g),s.setAttribute("aria-current",f?"step":"false")}),c&&(c.textContent=`Step ${g+1} of ${o.length}`),E&&(E.disabled=g===0),S&&(S.hidden=g===o.length-1),u&&(u.hidden=g!==o.length-1)},j=()=>{let s=o[g];if(!s)return;let l=s.querySelector('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])');l&&l.focus({preventScroll:!1})},C=(s,{focusField:l=!0}={})=>{let f=Math.min(Math.max(s,0),o.length-1);if(f===g){$(),l&&window.requestAnimationFrame(j);return}g=f,$(),l&&window.requestAnimationFrame(j)},B=()=>{if(!h)return;let l=r.querySelector('input[name="wv-registered"]:checked')?.value==="no";h.hidden=!l,m&&(m.required=!!l)},q=()=>{let s=r.querySelector('input[name="prior-remedy"]:checked')?.value;v.forEach(l=>{let f=s&&l.dataset.priorRemedy===s;l.hidden=!f;let I=l.querySelector("textarea");I&&(I.required=f&&s==="yes")})},F=()=>{if(!x)return;let s=x.value;if(!s){T&&(T.hidden=!0,T.textContent=""),M&&(M.hidden=!0),D&&(D.required=!1);return}let l=new Date(`${s}T00:00:00`);if(Number.isNaN(l.getTime()))return;let f=new Date,R=new Date(f.getFullYear(),f.getMonth(),f.getDate()).getTime()-l.getTime(),_=Math.floor(R/864e5),H="",z=!1,O=!1;if(_>30)H=`This date is ${_} days old. WVSDEC filings must arrive within 30 days, so explain why the deadline still applies.`,z=!0,O=!0;else if(_<0){let U=Math.abs(_);H=`This date is ${U} day${U===1?"":"s"} in the future. Share upcoming deadlines or hearing dates so we can plan accordingly.`,z=!0}T&&(H?(T.textContent=H,T.hidden=!1):(T.hidden=!0,T.textContent="")),M&&(M.hidden=!z),D&&(D.required=O)},K=()=>{A.forEach(s=>{s.dataset.originalRequired==="true"&&(s.required=!0)})};S?.addEventListener("click",()=>{B(),q(),F(),r.reportValidity()&&C(g+1)}),E?.addEventListener("click",()=>{C(g-1)}),p.forEach(s=>{s.addEventListener("change",()=>{B()})}),y.forEach(s=>{s.addEventListener("change",()=>{q()})}),x?.addEventListener("input",F),x?.addEventListener("change",F),r.addEventListener("submit",s=>{if(B(),q(),F(),K(),!r.checkValidity()){s.preventDefault();let l=r.querySelector(":invalid");if(l){let f=o.findIndex(I=>I.contains(l));f!==-1&&C(f,{focusField:!1}),window.requestAnimationFrame(()=>{l.reportValidity(),l.focus({preventScroll:!1})})}}},!0),r.addEventListener("reset",()=>{window.requestAnimationFrame(()=>{C(0,{focusField:!1}),B(),q(),F()})}),r.addEventListener("enhanced:success",()=>{r.reset(),C(0,{focusField:!1}),B(),q(),F()}),B(),q(),F(),C(0,{focusField:!1})}X();document.addEventListener("DOMContentLoaded",()=>{ee(),ne(),te()});"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(r=>{console.error("Service worker registration failed:",r)});})();
